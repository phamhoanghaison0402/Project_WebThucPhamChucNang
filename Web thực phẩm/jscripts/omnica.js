
var eventInvoked=false;var validateSelectedShippingOptionOk='';var isIE11=!!navigator.userAgent.match(/Trident.*rv\:11\./);function initLazyLoad(){var isTouchDevice=/MSIE 10.*Touch/.test(navigator.userAgent)||('ontouchstart'in window)||window.DocumentTouch&&document instanceof DocumentTouch;if(isTouchDevice){$("img.lazy").each(function(){var $this=$(this);$this.attr('src',$this.attr('data-original'));});}else{if($("#emailCartForm").length==0){$("img.lazy").lazyload({effect:"fadeIn",threshold:200,failure_limit:50,skip_invisible:false});}
setTimeout(function(){initScroller();},4000);$('.products-carousel,.brand-gallery').has('img.lazy').find('.btn-next,.btn-prev').click(function(e){setTimeout(function(){$(window).trigger('scroll');},200);eventInvoked=true;});}}
function initMyAccountHover(){$('#userAccDiv .user-block').on("touchstart",function(e){"use strict";var userAccContainer=$(this).parent();if(userAccContainer.hasClass('hover')){userAccContainer.removeClass("hover");var lnk=$(this).find('a.myAccLink');window.location.href=lnk.attr('href');return true;}else{userAccContainer.addClass("hover");e.preventDefault();return false;}});var $myAcc=$('#userAccDiv');$myAcc.click(function(e){$myAcc.toggleClass('hover');e.stopPropagation();});$(document).click(function(e){$myAcc.removeClass('hover');});}
function validateSelectedShippingOption(source,arguments){if($('.shipping-method-item-wrapper').length){arguments.IsValid=true;validateSelectedShippingOptionOk=true;}else{$('#litErrorMessage').text('Please click the "Get Shipping Options" button below in order to proceed');arguments.IsValid=false;validateSelectedShippingOptionOk=false;}}
function initMiniBasketHover(){$('.cartblock-holder .icon-cart').on("touchstart",function(e){"use strict";var miniCart=$(this).parent().parent();if(miniCart.hasClass('hover')){$(this).find('.drop-cart-wrap-main').hide();miniCart.removeClass("hover");window.location.href=miniCart.find('.icon-cart').attr('href');return true;}else{miniCart.addClass("hover");$(this).find('.drop-cart-wrap-main').show();e.preventDefault();return false;}});$('.user-block').click(function(){if($('.signinLink').length>0){window.location=$('.signinLink').attr('href');}});}
function initScroller(){if(!eventInvoked){setTimeout(function(){$(window).trigger('scroll');},200);}}
function initShipTo(){$('.perfect-scroll').each(function(){Ps.initialize(this);});var $shipDrop=$('.ship-country-drop');$shipDrop.find('li a').each(function(){var $a=$(this);var href=$a.attr('href');if($a.parents('.country').length>0){$a.attr('href',href+"&ReturnUrl="+ encodeURIComponent(document.location.pathname));}else{var a=$('<a>',{href:href})[0];a.pathname=document.location.pathname;$a.attr('href',a.href);}
$a.click(function(e){selectCountryOrLanguage($a);if($a.closest('.selector-column').hasClass('country')){var language=$a.data('language');selectCountryOrLanguage(selectCountryOrLanguage($shipDrop.find('.language li a[data-value="'+language+'"]')));}
if($(this).parents('#header').length){e.preventDefault();e.stopPropagation();}});});$shipDrop.find('.select-ship-opener').click(function(e){$shipDrop.toggleClass('active');$shipDrop.find('.pop-up-and-scroll').removeClass('active');e.stopPropagation();});$shipDrop.click(function(e){$shipDrop.find('.pop-up-and-scroll').removeClass('active');e.stopPropagation();});$(document).click(function(e){$shipDrop.removeClass('active');$shipDrop.find('.pop-up-and-scroll').removeClass('active');});$shipDrop.find('a.selected-locale').click(function(e){e.preventDefault();$(this).next().find('.pop-up-and-scroll').toggleClass('active');e.stopPropagation();});$('#save-country-selection').click(function(e){e.preventDefault();$(this).blur().css('background','#f1f0ef');$(this).css('background','url('+ rewritePathForCDN('/images/loading_icon_animate.gif')+') 5% 40% no-repeat').css('height','21px');$(this).text('PROCESSING...').css({'font-size':'14px','color':'#707070'});$shipDrop.find('.pop-up-and-scroll').removeClass('active');var countrySelector=$shipDrop.find('.country .selected-locale');var languageSelector=$shipDrop.find('.language .selected-locale');var newUrl='';if(languageSelector.data('value')!=$('body').data('language')){newUrl=languageSelector.attr('href');}
if(countrySelector.data('value')!=$('body').data('country')){if(newUrl==''){newUrl=countrySelector.attr('href');}else{newUrl+="&locale="+ encodeURIComponent(countrySelector.data('value'));}}
if(newUrl!=''){document.location.href=newUrl;}else{$shipDrop.removeClass('active');}});}
function selectCountryOrLanguage(itemClicked){var $a=$(itemClicked);$a.closest('ul').find('li a .current-selected').removeClass('current-selected');$a.find('.name').addClass('current-selected');$a.closest('.selector-column').find('.selected-locale').data('value',$a.data('value'));$a.closest('.selector-column').find('.selected-locale').attr('href',$a.attr('href'));$a.closest('.selector-column').find('.selected-locale .current').text($a.find('.name').text());$a.closest('.selector-column').find('.selected-locale .flag-frame').attr('class',$a.find('.flag-frame').attr('class'));$a.closest('.pop-up-and-scroll').removeClass('active');}
function MiniCartDisplayShopRunnerEligibilityFlag(){var isLoggedIn=$.cookie("sr_token");var srSubTotal=$('#hfsrSubTotal').val();if(isLoggedIn){var owiIneligible=$('#hfOWIIneligible').val();var inventory=$('#hfInventory').val();var ossDirectDlvMode=$('#hfOSSDirectDlvMode').val();var ossShippingSurcharge=$('#hfOSSShippingSurcharge').val();var ormd=$('#hfORMD').val();if((owiIneligible==0)&&(inventory>0)&&(ossDirectDlvMode==0)&&(ossShippingSurcharge<1)&&(ormd='False')){$("#sr_wrapper").show();}
else{$("#sr_wrapper").hide();}}
else{$("#sr_wrapper").hide();}
if(typeof _shoprunner_com!='undefined'&&_shoprunner_com.enabled){if($.isNumeric(srSubTotal)&&_shoprunner_com!=undefined&&_shoprunner_com.cart!=undefined){_shoprunner_com.cart.srSubTotal=srSubTotal*1;sr_updateMessages();}}}
function RemoveShopRunnerToken(){var domain=document.domain;$.removeCookie('sr_token',{path:'/'});$.removeCookie('sr_token',{path:'/',domain:domain});$.removeCookie('sr_token',{path:'/',domain:'.'+ domain});}
function ShoppingCartDisplayShopRunnerEligibilityFlag(){var isLoggedIn=$.cookie("sr_token");if(isLoggedIn){$('#rowItem .sr_eligible_flag').show();$('#pnlEligibleCart_SR').show();$('#pnlMixedCart_SR').hide();if($('#hfCartHasIneligibleItems').val()==1){$('#pnlEligibleCart_SR').hide();$('#pnlMixedCart_SR').show();}}else{$('#rowItem .sr_eligible_flag').hide();$('#pnlEligibleCart_SR').show();$('#pnlMixedCart_SR').hide();}}
function UpdateShippingOption(){var isLoggedIn=$.cookie("sr_token");var movthres=parseFloat($.cookie("sr_movThreshold"));var srcartST=0;if(typeof _shoprunner_com!='undefined'&&_shoprunner_com.enabled){if(_shoprunner_com.cart.srSubTotal!=undefined){srcartST=parseFloat(_shoprunner_com.cart.srSubTotal);}}
if(($('#hfCartHasIneligibleItems').val()==1)||(movthres>srcartST)||!isLoggedIn){$('#UpdatePanel1').show();$('#pnlShopRunnerShipping').hide();}
else{$('#UpdatePanel1').hide();$('#pnlShopRunnerShipping').show();}}
function initOmnica(){fixListingCadDisplay();initOmnicaFancyDropdowns();var spinners=[rewritePathForCDN('images/spinner_large.gif'),rewritePathForCDN('images/spinner.gif'),rewritePathForCDN('images/loading_icon_animate.gif')];for(var i=0;i<spinners.length;++i){var img=new Image();img.src=spinners[i];}
$('.btnContactUsSubmit').click(function(e){e.preventDefault();var firstname='';var lastname='';var comments='';var email='';var phone='';$('.contactUsBrand .ajax-zip-lookup .input-holder input').each(function(e){if(this.id.toLowerCase().indexOf("firstname")>=0)
firstname=$(this).val();else if(this.id.toLowerCase().indexOf("lastname")>=0)
lastname=$(this).val();else if(this.id.toLowerCase().indexOf("email")>=0)
email=$(this).val();else if(this.id.toLowerCase().indexOf("phone")>=0)
phone=$(this).val();});if($('#comments').length>0)
comments=$('#comments').first().val();if(runFormValidation()){var myObj={};myObj["firstname"]=firstname;myObj["lastname"]=lastname;myObj["phone"]=phone;myObj["comments"]=comments;myObj["email"]=email;var json=JSON.stringify(myObj);var url="ActionService.asmx/ContactUsBrandEmail";$.ajax({type:"POST",url:url,data:json,contentType:"application/json; charset=utf-8",dataType:"json",success:function(Data){var obj=jQuery.parseJSON(Data.d);$('#contactUs').addClass('narrow');if(obj.success=='1')
$('#contactUs').html('Thanks for contacting us. We will look into your query asap.');else
$('#contactUs').html('Sorry we had a problem processing your query. Please try again later.');},failure:function(msg){$('#contactUs').html('Sorry we had a problem processing your query. Please try again later.');}});}});if($('#aboutTheBrand').length>0){$('#aboutTheBrand').click(function(e){$('#aboutBrandContent').css('display','block');$('#content').css('display','none');$('#product-list').css('display','none');});$('#shopProducts').click(function(e){$('#aboutBrandContent').css('display','none');$('#content').css('display','block');$('#product-list').css('display','block');});}
if(($('#viewSpecialties').length>0)||($('#hideSpecialties').length>0)){$('#viewSpecialties').click(function(e){$('.hideable').removeClass('hideSpecialty');$('#viewSpecialties').hide();$('#hideSpecialties').show();});$('#hideSpecialties').click(function(e){$('.hideable').removeClass('hideSpecialty').addClass('hideSpecialty');$('#viewSpecialties').show();$('#hideSpecialties').hide();});}
$('.newWindow').click(function(event){var url=$(this).attr("href");var windowName="popUp";window.open(url,windowName,'toolbar=no, location=no, status=no, scrollbars=yes, width=800');event.preventDefault();});MiniCartDisplayShopRunnerEligibilityFlag();ShoppingCartDisplayShopRunnerEligibilityFlag();$('li.big-drop').on("touchstart",function(e){var aHref=$(this).find('a:first').attr('href');setTimeout(function(){window.location.href=aHref},200);});$('.vote-box a').click(function(e){e.preventDefault();var feedbackLink=$(this);var ratingID=$(this).parent().find('#hfRatingID').val();var feedbackHelpful=$(feedbackLink).attr('class');var HelpfulYesCount=$(this).parent().find('.helpful-yes-count');var HelpfulNoCount=$(this).parent().find('.helpful-no-count');if(!$(feedbackLink).hasClass("active")){$(this).parent().find('a.active').removeClass("active");var successMessage=$(this).parent().find('.review-vote-thank-you');$.ajax({type:"POST",url:"ActionService.asmx/HelpfulReviewFeedback",data:"{\"ratingID\":\""+ ratingID+"\",\"feedbackHelpful\":\""+ feedbackHelpful+"\",\"HelpfulYesCount\":\""+ HelpfulYesCount.text()+"\",\"HelpfulNoCount\":\""+ HelpfulNoCount.text()+"\"}",contentType:"application/json; charset=utf-8",dataType:"json",success:function(Data){$(feedbackLink).addClass('active');successMessage.show().delay(750).fadeOut(2500);var obj=jQuery.parseJSON(Data.d);HelpfulYesCount.text(obj.HelpfulYesCount);HelpfulNoCount.text(obj.HelpfulNoCount);},failure:function(msg){alert("fail");}});}});var tmpPlaceholder='';$('input[name=txtQuantity]').focus(function(){tmpPlaceholder=$(this).attr('placeholder');$(this).attr('placeholder','');$(this).select();}).blur(function(){$(this).attr('placeholder',tmpPlaceholder);});$('.atozinput').keydown(function(e){if(e.keyCode==13){e.preventDefault();}});$('.azl-zip').keydown(function(e){if(e.keyCode==13){e.preventDefault();$(this).blur();}});var loadingIcon=new Image();var loadingAnimateIcon=new Image();loadingIcon.src=rewritePathForCDN('images/spinner_large.gif');loadingAnimateIcon.src=rewritePathForCDN('images/loading_icon_animate.gif');$('.cart-page .link-remove, .cart-page .lnkupdate').click(function(){var imageLocation="";if(location.protocol==='https:'){}
else{}
var dialog='<div class="updating-message _hidden" style="position:fixed; margin-left:-100px; top:300px;">'
+'<img width="20" height="20" alt="image description" src="'+rewritePathForCDN('images/loading_icon_animate.gif')+'">'
+'<span class="text">LOADING</span>'
+'</div>';var settings={message:dialog,overlayCSS:{backgroundColor:'#fff',opacity:0.6,cursor:'wait',},css:{},timeout:10000};$('.cart-page .table-product').block(settings);});$('.sppListing .open.out-of-stock').each(function(){$(this).parent().parent().parent().prev('.qty-form').attr('style','display:none');$(this).parent().parent().parent().parent('.frame').attr('style','background:none');});$('#sort-reviews').change(function(){window.location=$(location).attr('pathname')+"?sort="+ $(this).val()+"#reviews";});$('#ctl00_PageContent_ctrlPaymentMethods_radPayPalExpress').prev('.rad-area').click(function(e){$('.payment-continue').val('NEXT: PROCEED TO PAYPAL');});$('#ctl00_PageContent_ctrlPaymentMethods_radCreditCard').prev('.rad-area').click(function(e){$('.payment-continue').val('NEXT: REVIEW MY ORDER');});$('#btnCheckOutNowTop, #btnCheckOutNowBottom').click(function(e){$(this).blur();$(this).css({'width':$(this).outerWidth(),'height':'47px','background':'none','border':'none','box-shadow':'0px','webkit-box-shadow':'0px','position':'relative'});$(this).html('<strong class="btn-processing big"><i class="ico-process"></i><p>Processing...</p></strong>');e.preventDefault();});$('.btn.chkoutguest').click(function(e){$(this).blur();$(this).css({'width':'217px','height':'48px','background':'none','border':'none','box-shadow':'none','webkit-box-shadow':'none'});$(this).html('<strong class="btn-processing"><i class="ico-process"></i><p>Processing...</p></strong>');});$('#emailCartForm a.close').click(function(e){parent.$.fancybox.close();e.preventDefault();});if($('.cart-page').length>0){if($('.cart-page td.item').length>0)
{$('#navBrowseBy').hide();$('.alphabet-nav').hide();}}
var selectedAlphabet=getParameterByName('letter');if(selectedAlphabet!=undefined){$('.alphabet-nav .list a:contains('+ selectedAlphabet+')').addClass('selected-alphabet');}
$('.emailWhenInStockButton').click(function(e){e.preventDefault();var name=$('#popupEmailWhenInStock').find('#f-Name');var email=$('#popupEmailWhenInStock').find('#f-Email');var prodID=$('#popupEmailWhenInStock').find('#hfProdID');$(name).closest('.form-row').removeClass('error');$(email).closest('.form-row').removeClass('error');var validated=true;if($(name).val()==""){$(name).closest('.form-row').addClass('error');validated=false;}
if($(email).val()==""||!validateEmail($(email).val())){$(email).closest('.form-row').addClass('error');validated=false;}
if(!validated){return false;}
$.ajax({type:"POST",url:"ActionService.asmx/EmailWhenInStock",data:"{\"name\":\""+ name.val()+"\",\"email\":\""+ email.val()+"\",\"prodID\":\""+ prodID.val()+"\"}",contentType:"application/json; charset=utf-8",dataType:"json",success:function(Data){$(name).val('');$(email).val('');$('#popupEmailWhenInStock').find('#emailWhenInStockThanks').removeClass('hidden');$('#popupEmailWhenInStock').find('#emailWhenInStockForm').addClass('hidden');setTimeout(function(){jQuery.fancybox.close();},2000);},failure:function(msg){alert("failed");}});});if(window.addEventListener){window.addEventListener('message',function(event){if(event.data=='close'){$.fancybox.close();}},false);}
else{window.attachEvent('message',function(event){if(event.data=='close'){$.fancybox.close();}});}
var altTextArr=new Array(6);altTextArr[0]="Click Stars To Rate Item";altTextArr[1]="Not Good";altTextArr[2]="Could be better";altTextArr[3]="Average/Meets Expectations";altTextArr[4]="Very Good";altTextArr[5]="Excellent – As Good As It Gets!";function selectRatingClover(wrapperId,ratingId,ratingMessageId,selectedRatingId){var selectedRating=ratingId;$(wrapperId+' .prStar').each(function(){$(this).removeClass('active');});$('.rating-row').removeClass('error');$('.comments-row').removeClass('error');for(var i=1;i<=selectedRating;i++){$(wrapperId+' #'+ i).addClass('active');}
$(ratingMessageId).text(altTextArr[selectedRating]).show();$(selectedRatingId).val(selectedRating)}
$('.orderRating > .prWrapper > .prStar').click(function(){var rowIndex=$(this).parent('.prWrapper').parent('.frame').find('.hfRowIndex').val();var wrapperId='#prWrapper-'+ rowIndex;var ratingId=$(this).attr('id');var ratingMessageId='#prMessage-'+ rowIndex;var selectedRatingId='#hfSelectedRating-'+ rowIndex;selectRatingClover(wrapperId,ratingId,ratingMessageId,selectedRatingId);});$('.productRating .prWrapper .prStar').click(function(){var wrapperId='#prWrapper';var ratingId=$(this).attr('id');var ratingMessageId='#prMessage';var selectedRatingId='#hfSelectedRating';selectRatingClover(wrapperId,ratingId,ratingMessageId,selectedRatingId);});$('.runValidateRatingStars').click(function(e){var result=validateRatingStars(false);if(jQuery.inArray(0,result)==-1){e.preventDefault();validateRatingStars(true);}});function validateRatingStars(showErrors){var errorStatus=[];$('.myProductReview_Wrapper').each(function(){$(this).find('.rating-row').removeClass('error');$(this).find('.comments-row').removeClass('error');var hfRowIndex=$(this).find('#hfRowIndex').val();var hfSelectedRating="";var txtReviewDetails="";hfSelectedRating=$('#hfSelectedRating-'+ hfRowIndex).val();if(showErrors){if(hfSelectedRating==0){$(this).find('.rating-row').addClass('error');}}
txtReviewDetails=$('#txtReviewDetails-'+ hfRowIndex).val();if(showErrors){if(txtReviewDetails.length==0){$(this).find('.comments-row').addClass('error');}}
if(hfSelectedRating>0&&txtReviewDetails.length>0){errorStatus.push(0);}
else{errorStatus.push(1);}});return errorStatus;}
$('.submitProductReview').click(function(e){e.preventDefault();$('.rating-row').removeClass('error');$('.comments-row').removeClass('error');var error="";var hfSelectedRating=$('#hfSelectedRating').val();var hfProdID=$('#hfProdID').val();if(hfSelectedRating==0){$('.rating-row').addClass('error');error=1;}
var prComments=$('#prComments').val();if(prComments==""){$('.comments-row').addClass('error');error=1;}
if(error==1){return false;}
else{$.ajax({type:"POST",url:"ActionService.asmx/WriteReview",data:"{\"productID\":\""+ hfProdID+"\",\"rating\":\""+ hfSelectedRating+"\",\"comment\":\""+ prComments+"\"}",contentType:"application/json; charset=utf-8",dataType:"json",success:function(Data){$('.reviewBody').hide();$('.reviewSuccess').show();},failure:function(msg){alert("fail");}});}});$('.con-shopping').click(function(){var previousurl=document.referrer;if(previousurl!=''){window.history.back();}
else{window.location.href="/";}});$('.cart-holder .box-holder .less').click(function(){var inputCounter=$('#counter');var inputCounterValue=inputCounter.val();if(!inputCounterValue)
$(inputCounter).val(1);if(inputCounterValue>1)
$(inputCounter).val(inputCounterValue- 1);});$('.cart-holder .box-holder .more').click(function(){var inputCounter=$('#counter');var inputCounterValue=Number(inputCounter.val());if(!inputCounterValue)
$(inputCounter).val(2);else
$(inputCounter).val(inputCounterValue+ 1);$('.counter-holder .input-placeholder-text').hide();});$('.omnica-validate .input-holder input').focus(function(){$(this).closest(".form-row").removeClass("error");$(this).closest('.frame').next('.frame').find('.validator').hide();});$('.omnica-validate .input-holder input').focusout(function(){var validator=$(this).closest('.frame').next('.frame').find(Page_Validators);validator.each(function(){var validation=runSingleValidation($(this).attr('id'));if(validation==0){return false;}});});$('.signin-form .input-holder input, .input-holder-text-area textarea').focus(function(){$(this).closest(".form-row").removeClass("error");$(this).closest('.frame').next('.frame').find('.validator').hide();});$('.signin-form .input-holder input, .input-holder-text-area textarea').focusout(function(){var validator=$(this).closest('.frame').next('.frame').find(Page_Validators);validator.each(function(){var validation=runSingleValidation($(this).attr('id'));if(validation==0){return false;}});});$('.omnica-validate .input-holder input').focusout(function(){var validator=$(this).closest('.frame').next('.frame').find(Page_Validators);validator.each(function(){});});$('#btnRegister').click(function(e){if(runFormValidation()){$(this).blur().addClass('btn-loading');$(this).find('.text').text('PROCESSING...');$(this).find('.arrow').hide();}
else{e.preventDefault();}});$('.btnRunValidation').click(function(e){if(runFormValidation()){}
else{e.preventDefault();}});$('#btnLogin_Checkout').click(function(e){if(runFormValidation()){$(this).blur().addClass('btn-loading');$(this).find('.text').text('PROCESSING...');$(this).find('.arrow').hide();}
else{e.preventDefault();}});$('#btnLogin').click(function(e){if(runFormValidation()){$(this).blur().addClass('btn-loading');$(this).find('.text').text('PROCESSING...');$(this).find('.arrow').hide();}
else{e.preventDefault();}});$('#btnUnsubscribe').click(function(e){if(runFormValidation()){}
else{e.preventDefault();}});function runFormValidation(){var val=Page_ClientValidate();if(!val){var i=0;for(;i<Page_Validators.length;i++){if(!Page_Validators[i].isvalid){$("#"+ Page_Validators[i].controltovalidate).closest(".form-row").removeClass("success");$("#"+ Page_Validators[i].controltovalidate).closest(".form-row").addClass("error");}}}
return val;}
$('#header .search-form input[type="submit"]').click(function(e){e.preventDefault();doSearch();});$('#header .search-form input').keydown(function(e){if(!$('header .search-form input[type="text"]').autocomplete("widget").element.is(":visible")&&e.keyCode==13){e.preventDefault();doSearch();}});if(window.OG&&OG.listen){try{OG.listen('cartChange',function(info){$('#ActiveMiniCart .og-offer').each(function(){var prods=info.productsChanged;$(this).replaceWith('<div class=\"og-offer\" data-og-module=\"cart_flydown\" data-og-product=\"'+ prods[0].id+'\"></div>');});});}
catch(err){}}
bindAddToCart();$('.updateQty_MiniCart').click(function(){$('#miniCart-AjaxLoader').show();var cartRecordID=$(this).parent().find('#hfShopCartRecID').val();var Quantity=$(this).parent().find('#txtQuantity').val();var enumCartType="1";if(Quantity<0){Quantity=Math.abs(Quantity);}
minicart_SetItemQuantity(cartRecordID,Quantity);$('#miniCart-AjaxLoader').hide();});$('.removeItem_MiniCart').click(function(){$('#miniCart-AjaxLoader').show();var cartRecordID=$(this).parent().find('#hfShopCartRecID').val();var enumCartType="1";var Quantity=0;minicart_SetItemQuantity(cartRecordID,Quantity);$('#miniCart-AjaxLoader').hide();});function minicart_SetItemQuantity(cartRecordID,Quantity){$.ajax({type:"POST",url:"ActionService.asmx/SetItemQuantity",data:"{\"cartRecordID\":\""+ cartRecordID+"\",\"Quantity\":\""+ Quantity+"\"}",contentType:"application/json; charset=utf-8",dataType:"json",success:function(Data){var obj=jQuery.parseJSON(Data.d);var updateType=obj.UpdateType;var showExStockMessage=obj.showExStockMessage;var inventory=obj.inventory;var itemCount=parseInt(obj.cartTotalQuantity);$('#hfsrSubTotal').val(obj.srSubTotal);if(updateType=="New Item"){$('#hfShopCartRecID').val(obj.shopCartRecID);$('.cartitem-image img').attr('src',obj.prodImage);$('.cartitem-image a').attr('href',obj.prodLink);$('.manufacturerName').text(obj.manufacturer);$('.productTitle a').text(obj.title).attr('href',obj.prodLink);;$('#txtQuantity').val(obj.quantity);$('.price').text(obj.price);$('.lblMiniCartItemCount').text(obj.cartTotalQuantity);if(itemCount>1){$('.lblMiniCartItems').text('Items');}
else{$('.lblMiniCartItems').text('Item');}
if(itemCount<1)
$('#topCheckoutBtn').css('display','none');else
$('#topCheckoutBtn').css('display','block');$('.lblMiniCartSubtotal').text(obj.cartSubTotal);$('.pyousaved').html(obj.cartSaving);}
else if(updateType=="New Quantity"){$('.lblMiniCartItemCount').text(obj.cartTotalQuantity);if(itemCount>1){$('.lblMiniCartItems').text('Items');}
else{$('.lblMiniCartItems').text('Item');}
if(itemCount<1)
$('#topCheckoutBtn').css('display','none');else
$('#topCheckoutBtn').css('display','block');$('.lblMiniCartSubtotal').text(obj.cartSubTotal);$('.pyousaved').html(obj.cartSaving);$('.price').text(obj.price);if(parseInt(showExStockMessage)==1){$('#txtQuantity').val(obj.inventory);}}
else if(updateType=="Empty Cart"){$('#ActiveMiniCart').addClass("hidden");$('#EmptyMiniCart').removeClass("hidden");$('.lblMiniCartItemCount').text(0);}
FreeShippingDisplayUpdate(obj.CalculateFreeShipping);MiniCartDisplayShopRunnerEligibilityFlag();if(window.OG&&OG.updateCart){try{if(Quantity=='')
Quantity=1;var sSKU=obj.skuID;if(obj.skuID!=''){if(obj.opType=='update'){OG.updateCart([{id:sSKU,module:'cart',quantity:Quantity}]);}
else if(obj.opType=='remove'){OG.removeFromCart([{id:sSKU}]);}}}
catch(err){}}
$('#miniCart-AjaxLoader').hide();},failure:function(msg){alert(msg);$('#miniCart-AjaxLoader').hide();}});}
$('.lnkupdate').hide();$('.promo-qualifier .fake-update, .promo-qualifier .cost').click(function(e){e.preventDefault();$(this).parent().find('.tbQty').focus().select();});var isOver=false;$('.lnkupdate').mouseover(function(){isOver=true;}).mouseleave(function(){isOver=false;});$('.tbQty').bind('focusin',function(){$(this).next('.lnkupdate').show();$(this).parents('.promo-qualifier').find('.box-input').show();$(this).parents('.promo-qualifier').find('.box-input .lnkupdate').show();$(this).parents('.promo-qualifier').find('.fake-update').hide();});$('.tbQty').bind('focusout',function(){if(!isOver){$(this).next('.lnkupdate').hide();$(this).parents('.promo-qualifier').find('.box-input').hide();$(this).parents('.promo-qualifier').find('.fake-update').show();if($(this).attr('initialvalue')!=$(this).val()){$(this).next('.lnkupdate').get(0).click();}}});$(".noletters").keypress(function(e){if(e.which!=8&&e.which!=0&&(e.which<48||e.which>57)){return false;}});$('#txtQuantity').keyup(function(e){var key=e.which;if(key==13)
{$(this).parent().next('.updateQty_MiniCart').click();window.location=window.location;return false;}});$('.NewsletterSignup_Click').click(function(){var CustomerEmail=$('.subscribeEmail').val();NewsletterSignup(CustomerEmail,true)});$('.NewsletterSignup_Click_2').click(function(){var CustomerEmail=$('.subscribeEmail_2').val();NewsletterSignup(CustomerEmail,false);});if($('.cart-page').length>0){listenCookieChange('og_autoship',function(){var theCookie=$.cookie("og_autoship");if(theCookie=='1'||theCookie==1){$('#btnPayPal').removeClass('btn-paypal add-loading rounded-border').addClass('btn-paypal add-loading rounded-border grayscale');$('#btnPayPal').attr('disabled','disabled');$('#btnPayPal').attr('style','cursor:auto');$('#btnPayPal').next('p').text('Paypal not available for some items in cart, including items with auto-ship.');}else{if($('#PPOk').val()=='1'){$('#btnPayPal').removeClass('btn-paypal add-loading rounded-border grayscale').addClass('btn-paypal add-loading rounded-border');$('#btnPayPal').removeAttr('disabled');$('#btnPayPal').attr('style','cursor:pointer');$('#btnPayPal').next('p').text('Fast, easy, secure.');}}});}
function NewsletterSignup(CustomerEmail,ScreenTop){var isNewsLetterPanelOnScreenTop=ScreenTop;if(validateEmail(CustomerEmail)){$('#errsubscribe2').addClass("hidden");$.ajax({type:"POST",url:"Newsletter.Subscribe.asmx/NewsletterSignup",data:"{\"CustomerEmail\":\""+ CustomerEmail+"\"}",contentType:"application/json; charset=utf-8",dataType:"json",success:function(Data){var obj=jQuery.parseJSON(Data.d);var SignupResult=obj.SignupResult;if(SignupResult==1){if(isNewsLetterPanelOnScreenTop){$('#NewsletterSignupForm').addClass('hidden');$('#NewsletterSignup_ThankYou').removeClass('hidden');var h=$('#NewsletterSignup_ThankYou').height();$(window).scrollTop(h);return true;}else{$('#NewsletterSignup2_ThankYou').removeClass('hidden');}}else{alert("Your email is already subscribed");$('.popup-wrap').removeClass('popup-active');$('.popup-wrap > .popup').hide();}},failure:function(msg){alert(msg);}});}
else{$('#errsubscribe2').removeClass("hidden");return false;}
return false;}
function validateEmail(CustomerEmail){var regEmail=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;return setState(CustomerEmail,!regEmail.test(CustomerEmail));}
function setState(field,error){if(error){$('.validate-form .error-message').show();return false;}else{$('.validate-form .error-message').hide();return true;}}
function RunFormValidation(formID){var successFlag=true;var $inputs=$('#'+ formID+' input[type=text],#'+ formID+' input[type=password]');$inputs.each(function(index){validateField($(this).attr('id'));});function validateField(id){var currentField=$('#'+ id);var currentParent=currentField.parents('.form-row');var regEmail=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;var currentPasswordParent=currentField.parents('.password-valid');var firstPass=currentPasswordParent.find('#txtPass1');var lastPass=currentPasswordParent.find('#txtPass2');if(currentField.hasClass('required')){setState(currentParent,currentField,!currentField.val().length||currentField.val()===currentField.prop('defaultValue'));}
else if(currentField.hasClass('required-email')){setState(currentParent,currentField,!regEmail.test(currentField.val()));}
else if(currentField.hasClass('required-password')){setState(currentPasswordParent,(firstPass,lastPass),!currentField.val().length||currentField.val()===currentField.prop('defaultValue')||firstPass.val()!=lastPass.val()||(firstPass.val().length<6||firstPass.val().length>16));}}
function setState(hold,field,error){hold.removeClass('error').removeClass('success');if(error){hold.addClass('error');field.one('focus',function(){hold.removeClass('error').removeClass('success');});successFlag=false;}else{hold.addClass('success');}}
return successFlag;}
var name=$("#txtYourName"),email=$("#txtYourEmail"),emailMessage=$("#txtEmailMessage"),friendEmail1=$("#txtFriendEmailAddress1"),friendEmail2=$("#txtFriendEmailAddress2"),friendEmail3=$("#txtFriendEmailAddress3"),friendEmail4=$("#txtFriendEmailAddress4"),friendEmail5=$("#txtFriendEmailAddress5"),allFields=$([]).add(name).add(email).add(friendEmail1).add(friendEmail2).add(friendEmail3).add(friendEmail4).add(friendEmail5),tips=$(".validateTips"),productID=$('#ProductID'),productName=$('#ProductName');function updateTips(t){tips.text(t).addClass("ui-state-highlight");setTimeout(function(){tips.removeClass("ui-state-highlight",1500);},500);}
function checkLength(o,n,min){if(o.val().length<min){o.addClass("ui-state-error");updateTips("Please Enter Your "+ n+".");return false;}else{return true;}}
function checkRegexp(o,regexp,n){if(!(regexp.test(o.val()))){o.addClass("ui-state-error");updateTips(n);return false;}else{return true;}}
$('.email-a-friend-form').dialog({autoOpen:false,height:'auto',width:600,modal:true,draggable:false,title:'Email a Friend'});$('.email-a-friend-btn').click(function(){$('.email-a-friend-form').dialog("open");});$('.send-email-to-a-Friend').click(function(){var bValid=true;allFields.removeClass("ui-state-error");bValid=bValid&&checkLength(name,"Name",1);bValid=bValid&&checkLength(email,"Email",1);bValid=bValid&&checkRegexp(email,/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i,"eg. ui@jquery.com");bValid=bValid&&checkLength(friendEmail1,"Friend's Email Address",1);bValid=bValid&&checkRegexp(friendEmail1,/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i,"eg. john.smith@luckyvitamin.com");if($("#txtFriendEmailAddress2").val()!=""){bValid=bValid&&checkLength(friendEmail2,"Friend's Email Address",1);bValid=bValid&&checkRegexp(friendEmail2,/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i,"eg. john.smith@luckyvitamin.com");}
if($("#txtFriendEmailAddress3").val()!=""){bValid=bValid&&checkLength(friendEmail3,"Friend's Email Address",1);bValid=bValid&&checkRegexp(friendEmail3,/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i,"eg. john.smith@luckyvitamin.com");}
if($("#txtFriendEmailAddress4").val()!=""){bValid=bValid&&checkLength(friendEmail4,"Friend's Email Address",1);bValid=bValid&&checkRegexp(friendEmail4,/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i,"eg. john.smith@luckyvitamin.com");}
if($("#txtFriendEmailAddress5").val()!=""){bValid=bValid&&checkLength(friendEmail5,"Friend's Email Address",1);bValid=bValid&&checkRegexp(friendEmail5,/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i,"eg. john.smith@luckyvitamin.com");}
if(bValid){$('#email-a-Friend-AjaxLoader').show();var emailFormData="{\"name\":\""+ name.val()+"\",\"email\":\""+ email.val()+"\", \"friendEmail1\":\""+ friendEmail1.val()+"\", "+"\"friendEmail2\":\""+ friendEmail2.val()+"\",\"friendEmail3\":\""+ friendEmail3.val()+"\", "+"\"friendEmail4\":\""+ friendEmail4.val()+"\",\"friendEmail5\":\""+ friendEmail5.val()+"\", "+"\"emailMessage\":\""+ emailMessage.val()+"\",\"productID\":\""+ productID.val()+"\", "+"\"productName\":\""+ productName.val()+"\",\"currentURL\":\""+ window.location.href+"\"}";$.ajax({type:"POST",url:"ActionService.asmx/sendEmailToAFriend",data:emailFormData,contentType:"application/json; charset=utf-8",dataType:"json",success:function(Data){$('#email-a-Friend-AjaxLoader').hide();alert(Data.d);$('.email-a-friend-form').dialog("close");},error:function(msg){alert("error - "+ msg.d);},faliure:function(msg){alert("fail - "+ msg.d);}});}});$('#btnUpdateEmailPreferences').click(function(e){e.preventDefault();var cboxPromos=$('#cboxLuckyPromos').is(':checked');var cboxHealth=$('#cboxHealthyUpdates').is(':checked');var myObj={};myObj["cboxPromos"]=cboxPromos;myObj["cboxHealth"]=cboxHealth;var json=JSON.stringify(myObj);$.ajax({type:"POST",url:"ActionService.asmx/UpdateEmailSubscriptions",data:json,contentType:"application/json; charset=utf-8",dataType:"json",success:function(Data){if(Data.d){$('#subscription-update-message').show();}},failure:function(msg){alert(msg);}});});$('.products-listview .tabset a').click(function(e){e.preventDefault();if(!$(this).hasClass('active')){if($(this).hasClass('show-aisle7')){$('.aisle7-hide').hide();$('.aisle7-show').show();}else{$('.aisle7-hide').show();$('.aisle7-show').hide();}
$('.products-listview .tabset a').toggleClass('active');$('.products-listview .tabset li').toggleClass('active-link');}});if($('.aisle7-show').length>0){var limiter=0;(function checkAisle7Load(){setTimeout(function(){var count=$('#hni_SearchResultsTopBarCount').text().replace('(','').replace(')','')*1;if(count>0||limiter++>100){$('#aisle7-article-count').text(count);}else{checkAisle7Load();}},400);})();}
initialiseZipLookup();if($('.my-account').length>0){$('body').addClass('my-account');}
$('.checkout,.my-account').on('change','select.country',function(){var val=$(this).val().toLowerCase();var selectedCountry=$(this).find("option:selected").text().toLowerCase();if($('.checkout').length>0&&$(this).parents('.payment-box').length==0&&!$('#pnlBillingAddress').is(":visible")){if($('.checkout-review').length>0){$('#hfCurrentCountryCode').val($('#hfCountry').val());$('#hfNewSelectedCountryCode').val(val.toUpperCase());$('.changeCountryPopup_Stage3').click();}
else{$('.changeCountryPopupTrigger').click();}}
else{loadCountryForm(val);initialiseZipLookup();}});$('.checkout').on('click','.change-country',function(e){e.preventDefault();$('#hfNewAddressID').val($(this).data("addressid"));$('.changeCountryPopup_Stage3').click();});$('#changeCountryPopup_Stage1 .close, #changeCountryPopup_Stage1 .btn-cancel').click(function(e){e.preventDefault();$('.checkout select.country').val($('#hfCountry').val().toUpperCase());$('.checkout select.country').parent().find('.select-ship2 .center').text($('.checkout select.country').find("option:selected").text());parent.$.fancybox.close();});$('form').on('click','.tabset-checkout-wrap li a',function(){$(this).find('input[type="radio"]').attr('checked','checked');if($(this).hasClass('enable-validation')){$('.payment-continue').val('NEXT: REVIEW MY ORDER');toggleValidation(true);}else{$('.payment-continue').val(('NEXT: PROCEED TO '+ $(this).text().toLowerCase().replace('use','')).replace(/[\r,\n,\t]/g,''));toggleValidation(false);}
if($(this).parents('li.int-tab').length>0){$(this).parents('.shipping-form').find('.payment-box .btn-area .btn').hide();}else{$(this).parents('.shipping-form').find('.payment-box .btn-area .btn').show();}});$('#changeCountryPopup_Stage1 .btn-confirm').click(function(){var selectedLocaleISOCode=$('.checkout select.country').find("option:selected").val().toLowerCase();window.location="setlocale.aspx?ReturnURL=ShoppingCart&ISOCode="+ selectedLocaleISOCode;});$('.checkout,.my-account').on('click','.tabset-checkout-wrap li a',function(e){var cc=$('#ctl00_PageContent_ctrlPaymentMethods_liCreditCard');var v=$('#ctl00_PageContent_ctrlPaymentMethods_valCardNumber');if(cc.hasClass('active')){$('#CreditCreditPayments').show();$('#DebitCreditPayments').hide();}
else
{$('#CreditCreditPayments').hide();$('#DebitCreditPayments').show();}});if($('.checkout a.disable-validation').hasClass("active")){toggleValidation(false);}
$('.checkout,.my-account').on('change','input.disable-validation , input.enable-validation ',function(e){if($(this).hasClass('enable-validation')){toggleValidation($(this).is(":checked"));}else{toggleValidation(!$(this).is(":checked"));}});if($('.checkout .disable-validation input').is(":checked")){toggleValidation(false);}
$('.openCountryPopup_Stage3').on('click',function(e){e.preventDefault();$('.changeCountryPopup_Stage3').click();var newCountryVal=$(this).parent().parent().parent().find('#hfCountry').val();$('#hfNewSelectedCountryCode').val(newCountryVal);});$('.checkout').on('click','#changeCountryPopup_Stage3 .btn-cancel',function(e){e.preventDefault();$('#popupShipping select.country').val($('#hfCountry').val().toUpperCase());$('#popupShipping select.country').parent().find('.select-ship2 .center').text($('#popupShipping select.country').find("option:selected").text());$('#btnPopupShipping').click();});function removeCityDropdownList(){var city=$('.azl-city');$(city).removeClass('default').removeClass('hidden');;$(city).parents('.was-input-holder').addClass('input-holder').removeClass('was-input-holder');$(city).parent().find('.azl-city-select').remove;jcf.customForms.destroyAll('.ajax-zip-lookup');jcf.customForms.replaceAll('.ajax-zip-lookup');$(city).parents('.ajax-zip-lookup').removeClass('.ajax-zip-lookup');}
function loadCountryForm(countryCode){var $ml=$('.ml-control');$ml.hide();$('.'+ countryCode).show();if(countryCode!='us'){$ml.each(function(){var $siblings=$(this).siblings('.ml-control').addBack();if(!$siblings.is(':visible')){$siblings.filter('.non-us').first().show();}});}
$('.addressLine1').val("");$('.addressLine2').val("");$('.azl-zip').val("");$('.azl-state').val("");}
$('.option-block').on('click','#divShipping_Standard li a',function(e){e.preventDefault();$('.option-block .shipping-method').val($(this).attr('rel'))
var active=$(this).parents('.shipping-popup').find('.open');$(active).find('.price').text($(this).find('.price').text());$(active).find('.name').text($(this).find('.name').text());$(active).find('.estimate').text($(this).find('.estimate').text());$(this).parents('.shipping-popup').removeClass('popup-active').find('.popup').hide();$('.option-block .shipping-method').change();});$('.option-block #divShipping_International').on('click','li a',function(e){e.preventDefault();var active=$(this).parents('.shipping-popup').find('.open');$(active).find('#litShippingPrice').text($(this).find('.price').text());$(active).find('#litShippingName').text($(this).find('.name').text());$(active).find('#litShippingEstimate').text($(this).find('.estimate').text());$(active).find('#hfShippingMethodID').val($(this).find('#hfShippingMethodID').val());$(this).parents('.shipping-popup').removeClass('popup-active').find('.popup').hide();});$('.checkout,.my-account').on('click','input[type="submit"]',function(e){$('#shipErrorDiv').hide();enrichzValidation(true);});$('.checkout,.my-account').on('focus','input,select',function(e){$(this).parents('.form-row').removeClass('success').removeClass('error').find('.validator').hide();});$('.checkout,.my-account').on('blur','input,select',function(e){fieldsDone[fieldsDone.length]=this.id;var validators=$(this).parents('.form-row').find(Page_Validators);validators.each(function(){var validation=runSingleValidation($(this).attr('id'));if(validation==0){$(this).css('display','block');return false;}});if($('#hfCountry').val()!='us')
hideNormalZipValidation();});if($('.checkout,.my-account').length>0){$('.checkout,.my-account').on('change','input.switch-btn',function(e){var checked=$(this).is(":checked");toggleValidation(!checked,'.shipping-form-box');if(checked){$('.shipping-form-box').hide();$('.check-row .address-holder').show();$('.editBillingAddress').show();}else{$('.shipping-form-box').show();$('.check-row .address-holder').hide();$('.editBillingAddress').hide();}});$('.editBillingAddress').on('click',function(){$('.shipping-form-box').show();$('.check-row .address-holder').hide();$('.editBillingAddress').hide();$('.checkout input.switch-btn').attr('checked',false);$('.chk-area').removeClass('chk-checked').addClass('chk-unchecked');$('.check-row-holder label').removeClass('chk-label-active');});if(!isPostback())enrichzValidation(true,true);else enrichzValidation(true,false);initCreditCardValidation();if($('#hfCountry').val()!='us')
hideNormalZipValidation();}
var prm=Sys.WebForms.PageRequestManager.getInstance();prm.add_initializeRequest(InitializeRequestHandler);prm.add_endRequest(EndRequestHandler);var url=window.location.href;if($('.facebookCommentsForSEO').length>0){$.getJSON('https://graph.facebook.com/comments/?ids='+ url,function(data){if(url&&url!='#'&&url!=''){if(!data['error']&&data[url]!=undefined&&data[url]['comments']!=undefined){var comments=data[url]['comments'];var results="";$.each(comments['data'],function(key,value){message=value.message;name=value.from.name;created=value.created_time;results+='<div><p>'+ message+'</p><p>'+ name+'</p><p>'+ created+'</p></div>';});$('.facebookCommentsForSEO').html(results);}}});}}
function initialiseZipLookup(){$('.ajax-zip-lookup').each(function(){var defaultmessage=$("div[id*='pnlZipPlus4']").css('display')=='block'?'Enter Zip Code First':'Enter Postal Code First';var initialised=false;var zip=$(this).find('.azl-zip');var city=$(this).find('.azl-city');var state=$(this).find('.azl-state');var country=$(this).find('.azl-country');var currentCity=$(city).val();var defaultCity=defaultmessage;if(currentCity==''){currentCity=defaultCity;}
var idCodeType=$(this).find('.azl-idcodetype');var idCode=$(this).find('.azl-idcode');var dobYear=$(this).find('.azl-dobyear');var dobMonth=$(this).find('.azl-dobmonth');var dobDay=$(this).find('.azl-dobday');jcf.customForms.destroyAll('.city-holder');$(this).find('.azl-city-select').remove();$(city).parent().append('<select class="ship2 required-select city azl-city-select"><option value="">'+ currentCity+'</option></select>');$(this).find('.azl-city-select').change(function(){$(city).val($(this).val());$(this).parents('.form-row').find('.validator').each(function(){ValidatorValidate(this);});});$(this).find('.azl-city-select').blur(function(){$(this).parents('.form-row').find('.validator').each(function(){ValidatorValidate(this);});});$(city).addClass('default');$(city).parents('.input-holder').addClass('was-input-holder').removeClass('input-holder').addClass('city-holder');jcf.customForms.replaceAll('.city-holder');$(city).addClass('hidden');var currentState=$(state).val();var defaultState=defaultmessage;if(currentState==''){currentState=defaultState;}
jcf.customForms.destroyAll('.state-holder');$(this).find('.azl-state-select').remove();$(state).parent().append('<select class="ship2 required-select state azl-state-select"><option value="">'+ currentState+'</option></select>');$(this).find('.azl-state-select').change(function(){$(state).val($(this).val());$(this).parents('.form-row').find('.validator').each(function(){var validation=runSingleValidation($(this).attr('id'));if(validation==0){return false;}});});$(this).find('.azl-state-select').blur(function(){$(this).parents('.form-row').find('.validator').each(function(){var validation=runSingleValidation($(this).attr('id'));if(validation==0){return false;}});});$(state).addClass('default');$(state).parents('.input-holder').addClass('was-input-holder').removeClass('input-holder').addClass('state-holder');jcf.customForms.replaceAll('.state-holder');$(state).addClass('hidden');var cityValidators=$(city).parents('.form-row').find('.validator');var stateValidators=$(state).parents('.form-row').find('.validator');var zipValidators=$(zip).parents('.form-row').find('.validator');zipValidators.each(function(){$(this).data('stateValidators',stateValidators);$(this).data('cityValidators',cityValidators);});zipCodeResult.zipHadFocus=false;$(zip).focus(function(){zipCodeResult.zipHadFocus=true;});stateValidators.each(function(){$(this).data('originalMessage',this.textContent);});cityValidators.each(function(){$(this).data('originalMessage',this.textContent);});var currentZipRequest=false;var lookupZip=function(doValidation){if(doValidation==undefined)doValidation=true;if($(country).find("option:selected").text().toLowerCase()!='brazil'){$(dobYear).val('1901');$(dobMonth).val('01');$(dobDay).val('01');}
if($(country).find("option:selected").text().toLowerCase()!='china'&$(country).find("option:selected").text().toLowerCase()!='brazil'&$(country).find("option:selected").text().toLowerCase()!='mexico'&$(country).find("option:selected").text().toLowerCase()!='south korea'){$(idCodeType).prop('selectedIndex',1);$(idCode).val('NA');}
else{if($('.insert-address').length>0){$(idCodeType).prop('selectedIndex',0);$(idCode).val(' ');if($(country).find("option:selected").text().toLowerCase()=='brazil'){$(dobYear).val(' ');$(dobMonth).val(' ');$(dobDay).val(' ');}}}
var postData={zip:$(zip).val(),country:$(country).find("option:selected").val().toLowerCase(),state:$(state).val()};zipCodeResult.waiting=true;zipCodeResult.waitingSince=$.now();var zipCodeIsValid;if(!currentZipRequest||currentZipRequest.zip!=postData.zip){if(currentZipRequest&&currentZipRequest.readyState!=4){currentZipRequest.abort();}
currentZipRequest=$.ajax({url:'ajaxZipLookup.aspx/LookupZip',data:JSON.stringify(postData),type:"POST",contentType:'application/json; charset=utf-8',success:function(data){if(data.d){zipCodeResult.valid=data.d.IsValid;zipCodeIsValid=zipCodeResult.valid;if(zipCodeIsValid){$('label[id*="lblCity"]').removeClass('disabled-label');$('label[for*="txtCity"]').removeClass('disabled-label');$('label[for*="txtState"]').removeClass('disabled-label');$('.select-city').removeClass('disable-city');$('.select-state').removeClass('disable-state');}
zipCodeResult.wrongCountry=data.d.WrongZipCountryCode;zipCodeResult.waiting=false;$(zip).val(data.d.Zip);var currentSelection=$(city).val();var isInNew=false;var cityOptions='';if(data.d.Cities.length>0){for(var i=0;i<data.d.Cities.length;i++){if(data.d.Cities[i]==currentSelection){isInNew=true;}
cityOptions+='<option value="'+ data.d.Cities[i]+'">'+ data.d.Cities[i]+'</option>';if(i==0){cityOptions+='<option value="'+ data.d.Cities[i]+'">'+ data.d.Cities[i]+'</option>';}}}else{cityOptions='<option value="">'+ defaultCity+'</option>';}
$('.azl-city-select').html(cityOptions);if(isInNew){$('.azl-city-select').val(currentSelection);}else{$(city).val(data.d.Cities[0]);}
var currentStateSelection=$(state).val();var isStateInNew=false;var stateOptions='';if(data.d.States.length>0){for(var i=0;i<data.d.States.length;i++){if(data.d.States[i]==currentStateSelection){isStateInNew=true;}
stateOptions+='<option value="'+ data.d.States[i]+'">'+ data.d.States[i]+'</option>';if(i==0){stateOptions+='<option value="'+ data.d.States[i]+'">'+ data.d.States[i]+'</option>';}}}else{stateOptions+='<option value="">'+ defaultState+'</option>';}
$('.azl-state-select').html(stateOptions);if(isStateInNew){$('.azl-state-select').val(currentStateSelection);}else{$(state).val(data.d.States[0]);}
if((doValidation||zipCodeResult.valid)&&initialised&&!isInNew&&!isStateInNew&&postData.zip.length>0){cityValidators.each(function(){var validation=runSingleValidation($(this).attr('id'));if(validation==0){return false;}});stateValidators.each(function(){var validation=runSingleValidation($(this).attr('id'));if(validation==0){return false;}});zipValidators.each(function(){var validation=runSingleValidation($(this).attr('id'));if(validation==0){return false;}});}}
var isTouchDevice=/MSIE 10.*Touch/.test(navigator.userAgent)||('ontouchstart'in window)||window.DocumentTouch&&document instanceof DocumentTouch;if(!isTouchDevice){jcf.customForms.destroyAll('.city-holder');jcf.customForms.destroyAll('.state-holder');}
jcf.customForms.replaceAll('.city-holder');jcf.customForms.replaceAll('.state-holder');initialised=true;if($(zip).val()==''||!zipCodeIsValid){$('label[id*="lblCity"]').addClass('disabled-label');$('label[for*="txtCity"]').addClass('disabled-label');$('label[for*="txtState"]').addClass('disabled-label');$('.select-city').addClass('disable-city');$('.azl-city-select').off();$('.select-state').addClass('disable-state');$('.select-state').off();$('.city-holder').addClass('disableClick');$('.state-holder').addClass('disableClick');}
else{$('.city-holder').removeClass('disableClick');$('.state-holder').removeClass('disableClick');}},error:function(data,textStatus,errorThrown){if(textStatus!='abort'){$(city).removeClass('default').removeClass('hidden');;$(city).parents('.was-input-holder').addClass('input-holder').removeClass('was-input-holder');$(city).parent().find('.azl-city-select').remove();jcf.customForms.destroyAll('.ajax-zip-lookup');jcf.customForms.replaceAll('.ajax-zip-lookup');$(city).parents('.ajax-zip-lookup').removeClass('.ajax-zip-lookup');}
zipCodeResult.waiting=false;}});}}
lookupZip();$(zip).blur(function(){lookupZip();});$(zip).on('change',function(){lookupZip();});$(country).blur(function(){if($('.checkout').length==0){lookupZip();}});$('#lbtnGetShippingOptions').focus(function(){lookupZip();showErrorOnZipChange();});$('#lbtnGetShippingOptions').click(function(){lookupZip();showErrorOnZipChange();});function showErrorOnZipChange(){var pageValid=Page_ClientValidate('addressZipOnly');if(!pageValid){$('.top-message').html('<h2>Sorry, there are some issues below</h2><p class=\"error-header-msg\">Postal code is required to obtain a shipping quote</p>');$('.top-message').show();$('#shippingQuoteError').html('<p style="color:red; font-size:12px; padding-top:2px;" class="validator">You must first enter a postal code above</p>');$('#shipErrorDiv').show();$('#shipErrorDiv').closest(".form-row").addClass("error");}
else{$('.top-message').hide();$('.error-header-msg').text('Please review the marked areas and try again');$('#shippingQuoteError').html();$('#shippingQuoteError').hide();$('#shipErrorDiv').hide();$('#shippingQuoteError').closest(".form-row").removeClass("error");}
if($('#hfCountry').val()!='us')
hideNormalZipValidation();}
$('.telphone').blur(function(){if($(this).val()!=''){var nPhone=$(this).val().replace(/[\D]/g,'');$(this).val(nPhone);}});});}
function hideNormalZipValidation(){if($('#ctl00_PageContent_ShippingAddress_cvZipOnlyValidator').is(':visible')){$('#ctl00_PageContent_ShippingAddress_valZipCode').text('');}}
function initCreditCardValidation(){$('.apply-credit-card-validation').validateCreditCard(function(result){var savedType=$('#hiddenCardType').val();var savedNumber=$('#hiddenCardNumber').val();if(savedType.length>0&&savedNumber.indexOf("****")==0&&$('.apply-credit-card-validation').val()==savedNumber){result.luhn_valid=true;result.length_valid=true;result.card_type={name:savedType.toLowerCase()};}
var typeName='';if(result.card_type!=null&&result.card_type.name!=null){typeName=result.card_type.name}
if(typeName=='diners_club_international')typeName='diners';var foundActive=false;$('.payment-list li').each(function(){if($(this).hasClass(typeName)){$(this).addClass('active');foundActive=true;}else{$(this).removeClass('active');}});if(!foundActive){result.luhn_valid=false;result.length_valid=false;result.card_type=null;$('.payment-list li').removeClass('active');}
creditCardValidation=result;},{accept:['visa','mastercard','discover','amex','unionpay','diners_club_international','jcb','dankort','aura','hipercard','elo','debit']});}
function toggleValidation(enable,parentSelector){if(typeof(Page_Validators)!="undefined"&&Page_Validators!=undefined&&Page_Validators!=null){var container;var global=false;if(parentSelector!=undefined){container=$(parentSelector);}else{global=true;}
for(var i=0;i<Page_Validators.length;i++){var toggleIt=global||$(container).find('#'+ Page_Validators[i].id).length>0;if(toggleIt){if(Page_Validators[i].id=='ctl00_PageContent_ctrlPaymentMethods_valCardNumber'){var cc=$('#ctl00_PageContent_ctrlPaymentMethods_liCreditCard');Page_Validators[i].enabled=cc.hasClass('active');}
else{Page_Validators[i].enabled=enable;Page_Validators[i].isvalid=true;}
ValidatorUpdateDisplay(Page_Validators[i]);}}}}
var creditCardValidation=null;function valCardNumber_ClientValidate(source,args){if(creditCardValidation!=null){var result=creditCardValidation.card_type!=null&&(creditCardValidation.luhn_valid||creditCardValidation.card_type.name.toLowerCase()=='unionpay')&&creditCardValidation.length_valid;args.IsValid=result;}}
function valExpiryDate_ClientValidate(source,args){var month=$('#'+ source.controltovalidate).parents('.form-row').find('select[id$="ExpiryMonth"]').val()*1;var year=$('#'+ source.controltovalidate).parents('.form-row').find('select[id$="ExpiryYear"]').val()*1;if(month==NaN||year==NaN){args.IsValid=false;}else{var expiryDate=new Date(year,month,1);var thisMonth=new Date();thisMonth.setDate(1);args.IsValid=expiryDate>=thisMonth;}}
function valSecurityCode_ClientValidate(source,args){if(args.Value.indexOf('***')!=0){var regex=new RegExp();if(creditCardValidation.card_type.name=='amex'){regex=/^[0-9]{4,4}$/;}else{regex=/^[0-9]{3,3}$/;}
args.IsValid=regex.test(args.Value);}else{args.IsValid=true;}}
var zipCodeResult={waiting:true,valid:false,wrongCountry:false,waitingSince:$.now(),zip:'',zipHadFocus:false};function valZipCode_ClientValidate(source,args){args.IsValid=true;if(args.Value==''){args.IsValid=false;if($('#hfCountry').val()!='us'){source.textContent='Postal code is required';$(source).closest(".form-row").removeClass("success");$(source).closest(".form-row").addClass("error");$(document).scrollTop(0);}
else{source.textContent='Zip code is required';}}else if(zipCodeResult!=null){if(!zipCodeResult.waiting||$('#hfCountry').val()!='us'){args.IsValid=zipCodeResult.valid;if(zipCodeResult.wrongCountry){source.textContent='Invalid zip code for the country selected in the drop down';}
else if($('#hfCountry').val()!='us'){source.textContent='Invalid postal code';}
else
{source.textContent='Invalid zip code';}
if($('#hfCountry').val()!='us')
hideNormalZipValidation();var $source=$(source);$source.data('stateValidators').each(function(){if($('#hfCountry').val()!='us')
hideNormalZipValidation();if(!args.IsValid){$(source).closest(".form-row").removeClass("success");$(source).closest(".form-row").addClass("error");return false;}});$source.data('cityValidators').each(function(){if($('#hfCountry').val()!='us')
hideNormalZipValidation();if(!args.IsValid){$(source).closest(".form-row").removeClass("success");$(source).closest(".form-row").addClass("error");return false;}});}}}
function valCityAndState_ClientValidate(source,args){args.IsValid=args.Value!='';var $source=$(source);if(!zipCodeResult.zipHadFocus){if($('#hfCountry').val()!='us'){source.textContent='Please enter a valid postal code first';}
else{source.textContent='Please enter a valid zip first';}}else{source.textContent=$source.data('originalMessage');}
fieldsDone[fieldsDone.length]=source.controltovalidate;}
var blockedAjax=new Array();function InitializeRequestHandler(sender,args){$.blockUI.defaults.css={};var dialog='<div class="updating-message _hidden">'
+'<img width="20" height="20" alt="image description" src="'+rewritePathForCDN('images/loading_icon_animate.gif')+'">'
+'<span class="text">LOADING</span>'
+'</div>';var settings={message:dialog,overlayCSS:{backgroundColor:'#fff',opacity:0.6,cursor:'wait'},css:{top:'-200px'},timeout:60000};if($(sender._activeElement).parents('.lightbox-content').length>0){blockedAjax=$(sender._activeElement).parents('.lightbox-content');$(blockedAjax).block(settings);}else if($('.block-me').length>0){var message=$('.block-me').attr('data-message');if(message.length>0){var element=$(dialog);$(element).find('.text').text(message)
settings.message=element,$('.block-me').block(settings);}else{$('.block-me').block(settings);}}
else{$('.shipping-form').block(settings);}}
function EndRequestHandler(sender,args){if(blockedAjax!=undefined&&blockedAjax.length>0){$(blockedAjax).unblock();}else{$('.block-me').unblock();$('.shipping-form').unblock();}
jcf.customForms.replaceAll('.cart-holder');jcf.customForms.replaceAll('.reward-area');initRadioRows();initPopups();initLightbox();initValidation();initTabs();initCreditCardValidation();initialiseZipLookup();enrichzValidation(false,false);var isTouchDevice=/MSIE 10.*Touch/.test(navigator.userAgent)||('ontouchstart'in window)||window.DocumentTouch&&document instanceof DocumentTouch;if(!isTouchDevice){jcf.customForms.destroyAll('.lightbox-content,.address-content,.shipping-form-box');}
jcf.customForms.replaceAll('.lightbox-content,.address-content,.shipping-form-box');var dataItems=args.get_dataItems();for(var i in dataItems){var action=dataItems[i];if(action=='close'){parent.$.fancybox.close();}else if(action=='refresh'){}else if(action=='show'){$('#showBillingForm').click();}else if(action=='showPopup'){alert("test");}else if(action=='optimovePopup'){$('#btnOptimovePromoEmailAddressChanged').click();}}}
var fieldsDone=new Array();function enrichzValidation(doAll,onlyNegative){if(onlyNegative==undefined)onlyNegative=false;if(!$.deparam.querystring()["externalError"]){$('.error-header').hide();}
if(typeof(Page_Validators)!="undefined"&&Page_Validators!=undefined&&Page_Validators!=null){for(var i=0;i<Page_Validators.length;i++){$('#'+ Page_Validators[i].controltovalidate).parents('.form-row').removeClass('success').removeClass('error');}
var zipOk=true;for(var i=0;i<Page_Validators.length;i++){var isInvalidCityOrState=false;var doneThisOne=false;for(var j=0;j<fieldsDone.length;j++){if(fieldsDone[j]==Page_Validators[i].controltovalidate){if(Page_Validators[i].controltovalidate.indexOf('_txtZip')>0&&!Page_Validators[i].isvalid){zipOk=false;}
var sCurrentValField=Page_Validators[i].controltovalidate;if(!zipOk&&((sCurrentValField.indexOf('_txtCity')>0)||(sCurrentValField.indexOf('_txtState')>0))){isInvalidCityOrState=true;}
doneThisOne=true;break;}}
if(!Page_Validators[i].isvalid||isInvalidCityOrState){$('#'+ Page_Validators[i].id).css('display','block');$('#'+ Page_Validators[i].controltovalidate).parents('.form-row').addClass('error').removeClass('success');if($('.error-header').length>0){$('.error-header').show().scrollTop();window.scrollTo(0,$('.error-header').offset().top);if(!isPostback()){validateSelectedShippingOptionOk=$('.shipping-method-item-wrapper').length>0;$('.error-header .title-error').text('Sorry, there are some issues below');if(!validateSelectedShippingOptionOk&&$('#hfCountry').val()!='us'&&$('.checkoutShippingInternational').length>0){$('.error-header-msg').text('Please click the "Get Shipping Options" button below in order to proceed');}
else
$('.error-header-msg').text('Please review the marked areas and try again');}}}
else if(!$('#'+ Page_Validators[i].controltovalidate).parents('.form-row').hasClass('error')&&(doAll||doneThisOne)&&!onlyNegative){$('#'+ Page_Validators[i].controltovalidate).parents('.form-row').addClass('success');}}}}
function bindAddToCart(){$('.AddToCartButton').click(function(e){e.preventDefault();if($(this).hasClass('disabled')){return false;}
var ProductID;if($(this).parents('.add-to-cart-fields').find('input[name=hfProductID]').val()){ProductID=$(this).parents('.add-to-cart-fields').find('input[name=hfProductID]').val();}
else{ProductID=$(this).parents('.add-to-cart-fields').find('#hfProductID').val();}
var RecID=-1;if($('#wrapper').hasClass('wishlist')){RecID=$(this).parents('.add-to-cart-fields').find('input[name=hfShoppingCartRecID]').val();}
var VariantID=$(this).parents('.add-to-cart-fields').find('input[name=hfVariantID]').val();var Quantity=$(this).parents('.add-to-cart-fields').find('input[name=txtQuantity]').val();var buttonClicked=$(this).attr('name');var RecurringDays=0;if(buttonClicked=="productAddToCart"){var selectedDeliveryOption=$('.delivery-option-wrapper').find('.row.active .radio').attr('id');if(selectedDeliveryOption=="rdoOneTimeOnly"){RecurringDays=0;}
else if(selectedDeliveryOption=="rdoAutoShip"){RecurringDays=$('.add-to-cart-fields').find('select[name=reorder]').val();}}
else{RecurringDays=$(this).parents('.add-to-cart-fields').find('select[name=reorder]').val();}
var CartType="0"
if(RecurringDays==null)RecurringDays=0;AddToCartScript(ProductID,VariantID,Quantity,CartType,RecurringDays,RecID);if(e.target.id=='AddLuckyItem'){$('#aspnetForm').submit();}});$('.AddToWishlist').click(function(e){e.preventDefault();var ProductID=$(this).parents('.add-to-cart-fields').find('input[name=hfProductID]').val();var VariantID=$(this).parents('.add-to-cart-fields').find('input[name=hfVariantID]').val();var Quantity=$(this).parents('.add-to-cart-fields').find('input[name=txtQuantity]').val();var RecID=-1;if($('#wrapper').hasClass('wishlist')){RecID=$(this).parents('.add-to-cart-fields').find('input[name=hfShoppingCartRecID]').val();}
var CartType="1"
AddToCartScript(ProductID,VariantID,Quantity,CartType,"0",RecID);});$('.AddToRegimen').click(function(e){e.preventDefault();var ProductID=$(this).parents('.add-to-cart-fields').find('input[name=hfProductID]').val();var VariantID=$(this).parents('.add-to-cart-fields').find('input[name=hfVariantID]').val();var Quantity=$(this).parents('.add-to-cart-fields').find('input[name=txtQuantity]').val();var RecID=-1;if($('#wrapper').hasClass('regimen')){RecID=$(this).parents('.add-to-cart-fields').find('input[name=hfShoppingCartRecID]').val();}
var CartType="3"
AddToCartScript(ProductID,VariantID,Quantity,CartType,"0",RecID);});}
function AddToCartBySku(sku,quantity,CartType,callback){AddToCartScript('','',quantity,CartType,'0','0',sku,callback);}
function AddToCartScript(ProductID,VariantID,Quantity,CartType,RecurringDays,RecID,SKU,callback){$('#prodDetail-AjaxLoader').show();var buttonSelector='';var textSelector='';if(Number(ProductID)>0){buttonSelector+='.ico.'+ ProductID;textSelector+='.atc-text.'+ ProductID}else{buttonSelector+='#FrequentlyBoughtMyBuyZone .ico';textSelector+='#FrequentlyBoughtMyBuyZone .atc-text';}
var currentButton=$(buttonSelector).parent('.AddToCartButton');var currentIcon=$(buttonSelector);var currentText=$(textSelector);$(currentButton).addClass('disabled');$(currentButton).blur().css('background','#f1f0ef');$(currentIcon).css('background','url('+rewritePathForCDN('images/loading_icon_animate.gif')+') no-repeat').css('height','21px');$(currentText).text('PROCESSING...').css({'font-size':'14px','color':'#707070'});var myObj={};var url="ActionService.asmx/AddToCart";if(SKU!=undefined){myObj["SKU"]=SKU;url="ActionService.asmx/AddToCartBySKU";}else{myObj["ProductID"]=ProductID;myObj["VariantID"]=VariantID;myObj["TextOption"]="";myObj["ShoppingCartRecordID"]=RecID;myObj["RecurringDays"]=RecurringDays;}
myObj["CartType"]=CartType;myObj["Quantity"]=Quantity;var json=JSON.stringify(myObj);$.ajax({type:"POST",url:url,data:json,contentType:"application/json; charset=utf-8",dataType:"json",success:function(Data){if(Data.d){var obj=jQuery.parseJSON(Data.d);var CartType=obj.CartType;var inventory=obj.inventory;var showExStockMessage=obj.showExStockMessage;var itemCount=parseInt(obj.CartTotalQuantity);if(CartType=="ShoppingCart"){if(obj.Success){$('#hfShopCartRecID').val(obj.shopCartRecID);$('.cartitem-image img').attr('src',obj.prodImage);$('.cartitem-image a').attr('href',obj.prodLink);$('.manufacturerName').text(obj.manufacturer);$('.productTitle a').text(obj.title);$('.productTitle a').text(obj.title).attr('href',obj.prodLink);;$('#txtQuantity').val(obj.quantity);$('.price').text(obj.price);$('.lblMiniCartItemCount').text(obj.CartTotalQuantity);if(itemCount>1){$('.lblMiniCartItems').text(' Items');}
else{$('.lblMiniCartItems').text(' Item');}
if(itemCount<1)
$('#topCheckoutBtn').css('display','none');else
$('#topCheckoutBtn').css('display','block');$('.lblMiniCartSubtotal').text(obj.CartSubTotal);$('.pyousaved').html(obj.cartSaving);if(parseInt(showExStockMessage)==1){var dialog='<div class="updating-message _hidden" style="position:fixed; margin-left:-250px; top:300px;">'
+'<p>We have reduced your ordered quantity to '+ inventory+' which is the maximum amount we have available. We are currently not accepting back orders on this item.</p>'
+'</div>';var settings={message:dialog,overlayCSS:{backgroundColor:'#fff',opacity:0.6,cursor:'wait',},css:{},timeout:5000};$('#content').block(settings);}
$('#ActiveMiniCart').removeClass("hidden");$('#EmptyMiniCart').addClass("hidden");$("#miniCartBlock .cartblock-holder").addClass("hover").delay(3200).queue(function(next){$(this).removeClass("hover");next();});$('#hfOWIIneligible').val(obj.OWIIneligible);$('#hfInventory').val(obj.inventory);$('#hfOSSDirectDlvMode').val(obj.OSSDirectDlvMode);$('#hfOSSShippingSurcharge').val(obj.OSSShippingSurcharge);$('#hfORMD').val(obj.ORMD);$('#hfsrSubTotal').val(obj.srSubTotal);MiniCartDisplayShopRunnerEligibilityFlag();if(window.OG&&OG.updateCart){try{if(Quantity=='')Quantity=1;var sSKU=obj.skuID;var sModule='';var sPageName=getPageName(window.location.pathname).toLowerCase();if(sPageName.substr(0,2)=='p-')
sModule='pdp';else if(sPageName.substr(0,11)=='my-wishlist')
sModule='wishlist';else if((sPageName.substr(0,2)=='m-')||(sPageName.substr(0,2)=='c-')||(sPageName.substr(0,3)=='sb-')||(sPageName.substr(0,2)=='s-'))
sModule='category';OG.updateCart([{id:sSKU,module:sModule,quantity:Quantity}]);}
catch(err){}}}else{window.location.href='ShoppingCart?ExceededLimit=1';}}
else if(CartType=="WishCart"&&RecID>0){if(obj.NotLoggedIn=="1")
window.location.href="signin.aspx?returnurl="+ window.location.pathname;else
alert("Item removed from wishlist");}
else if(CartType=="WishCart"){if(obj.NotLoggedIn=="1")
window.location.href="/signin.aspx?returnurl="+ window.location.pathname+'&wishlist=1&prodid='+ obj.prodid;else
alert("Item added to wishlist");}
else if(CartType=="Regimen"&&RecID>0){alert("Item removed from regimen");}
else if(CartType=="Regimen"){if(obj.NotLoggedIn=="1")
window.location.href="/signin.aspx?returnurl="+ window.location.pathname+'&regimen=1&prodid='+ obj.prodid;else
alert("Item added to regimen");}
if(RecID>0){$.bbq.pushState({w:RecID});}
FreeShippingDisplayUpdate(obj.CalculateFreeShipping);$('#prodDetail-AjaxLoader').hide();$(currentText).parent().html('<i class="ico '+ ProductID+'"></i><span class="atc-text '+ ProductID+'">ADD TO CART</span>').css('background-color','');$(currentButton).removeClass('disabled');if(callback!=undefined&&typeof callback=='function'){callback();}}},failure:function(msg){alert(msg);$('#prodDetail-AjaxLoader').hide();$(currentText).parent().html('<i class="ico '+ ProductID+'"></i><span class="atc-text '+ ProductID+'">ADD TO CART</span>').css('background-color','');$(currentButton).removeClass('disabled');}});}
function getPageName(url){var index=url.lastIndexOf("/")+ 1;var filenameWithExtension=url.substr(index);var filename=filenameWithExtension.split(".")[0];return filename;}
function FreeShippingDisplayUpdate(FreeShippingStatus){$('#divNoFreeShipping').addClass("hidden");$('#divNearlyFreeShipping').addClass("holder hidden");$('#divFreeShippingEarned').addClass("holder order hidden");if(FreeShippingStatus==0){$('#divNoFreeShipping').removeClass("hidden");}
else if(FreeShippingStatus==-1){$('#divFreeShippingEarned').removeClass("hidden");}
else if(FreeShippingStatus!=-2){$('#divNearlyFreeShipping').removeClass("hidden");$('#lblAmountFromFreeShipping').text(FreeShippingStatus);}
$('#divMiniCart_NearlyFreeShipping').addClass("ribbon hidden");$('#divMiniCart_FreeShippingEarned').addClass("ribbon earned hidden");if(FreeShippingStatus==-1){$('#divMiniCart_FreeShippingEarned').removeClass("hidden");}
else if(FreeShippingStatus!=-2){$('#divMiniCart_NearlyFreeShipping').removeClass("hidden");$('#divMiniCart_AmountFromFreeShipping').html(FreeShippingStatus);}}
(function($){$.fn.ajaxList=function(options){var settings=$.extend({serviceUrl:"Search.aspx/PerformSearch",moreOptionsUrl:"Search.aspx/GetAllRefinables",products:"#search-results",itemSelector:"#search-results li",refineableSelector:".refinable",refineableItemSelector:".refinable .native-scrollable-area .f-line",ratingItemSelector:".refinable .rating-block .f-line",blockedArea:"#content",blockUISettings:{message:null,overlayCSS:{background:'url('+rewritePathForCDN('images/spinner_large.gif')+') no-repeat scroll center 150px #FFFFFF',opacity:0.6,cursor:'wait'}},keywords:'',entityName:'',entityID:0,specialtyIconSelector:'.ingredients li',searchType:'product',ajaxEnabled:true,allowBackOrder:1},options);$this=$(this);var skipUpdate=false;var currentRequest=false;var ignorePriceChange=false;var spinner=new Image();spinner.src=rewritePathForCDN('images/spinner_large.gif');$this.find('.sidebar-block .default').removeClass('default');var itemTemplate=$($this.find(settings.itemSelector)[0]).clone();$(itemTemplate).find('.product-info .col').first().html('<div class="col">'+'<div id="availabilitycount" name="availabilitycount" runat="server" class="sppAvailabilityCount"><div>ONLY <span>1</span> LEFT</div></div>'+'<del class="retail msrp-price msrp"><span class="sppMSRP">MSRP:</span>$8.99</del>'+'<del class="retail msrp-price usualPrice"><span class="sppMSRP">Usually:</span>$5.39</del>'+'<span class="sppYellowBG">Sale Price</span>'+'<ins class="new-price selling-price"><span>3.65</span></ins>'+'<div class="special-block"><span>Special Price</span></div>'+'<p class="per-serving">Per Serving: $0.15</p>'+'<p class="per-servingsize">Serving Size: 4.00 Chew(s)</p>'+'<span class="save-count">You Save <span class="save-percent">59</span>%</span>'+'<div class="low">'+'<a href="previewCart?ProductID=" class="lower-price iframe lightbox" title="too low to show">Too Low to Show</a>'+'<a class="tooLowQM lightbox" href="#why-hidden-price">?</a>'+'<a href="previewCart?ProductID=" class="toolowprice iframe lightbox" title="Preview">Click to see sale price in cart</a>'+'</div>'+'<div class="popup-wrap">'+'  <a href="#rewards-pop" class="open reward-points lightbox"></a>'+'</div>'+'</div>');$(itemTemplate).find('.pricing-column .info-block .popup-wrap').html('<a href="#" class="open in-stock"><i class="ico"></i><span></span>In Stock</a>'+'<a class="open back-ordered" href="#">Back Ordered <br> <span class="leadtime">2-4 days</span></a>'+'<a class="open out-of-stock" href="#">Manufacturer out of stock</a>'+'<div class="stock-message popup">'+'<a href="#" class="close">close</a>'+'<div class="holder back-ordered-message">'+'<h3>On Back Order</h3>'+'<h4>Estimated To Ship In: <span class="mark leadtime">2-4 Days</span></h4>'+'<p>(This will NOT delay shipping of in slock items)</p>'+'<div class="order-line">'+'<b>I\'ll order later. <a href="#popupEmailWhenInStock" class="lightbox">Email me when stock arrives.</a></b>'+'</div>'+'</div>'+'<div class="holder in-stock-message">'+'<h3>In Stock</h3>'+'<h4>Usually Ships Within: <span class="mark leadtime">24-48 hours</span></h4>'+'</div>'+'<div class="holder out-of-stock-message">'+'<h3>Manufacturer Out Of Stock</h3>'+'<div class="order-line">'+'<b>This item is currently unavailable. <a href="#popupEmailWhenInStock" class="lightbox">Email me when stock arrives.</a></b>'+'</div>'+'</div>'+'</div>');$(itemTemplate).find('.og-offer').html('<div class="og-offer" data-og-module="category" data-og-product="12345"></div>');$(itemTemplate).find('.description-area').html('<span class="limited-row">'+'<mark class="limited"></mark><span class="promo-name">NW 1 - Money Off</span> '+'<span class="discount-popup details"><a href="#" class="open">Details</a>'+'<div class="popup" style="display: none;">'+'<i class="ico-arrow-t"></i><a href="#" class="close">Close</a><h3><span class="promo-name">NW 1 - Money Off</span> </h3>'+'<p><span class="promo-msg">NW 1 - Money Off</span></p>'+'</div></span></span>');var refineableTemplate=$($this.find(settings.refineableItemSelector)[0]).clone();var ratingTemplate=$($this.find(settings.ratingItemSelector)[0]).clone();var firstSpecialty=$this.find(settings.specialtyIconSelector).first();var specialtyTemplate=$(firstSpecialty).clone(firstSpecialty);$this.find(settings.specialtyIconSelector+' a.open[href="#"]').closest('li').remove();var updateRefinables=false;if(settings.ajaxEnabled){$this.find(settings.refineableSelector+' a').not('.more-options').each(function(){var $a=$(this);var href=$a.attr('href');if(href!=undefined){var qs=$.param.querystring(href);var questionMark=href.lastIndexOf('?');if(questionMark>0){href=href.substring(0,questionMark);;$a.attr('href',$.param.fragment(href,{q:prettifyFragment(qs)},0));}}});}
var currentRefinements=new Array();$('.native-scrollable-area').scroll(function(){var request=null;var $scrollable=$(this);if($scrollable.scrollTop()>=$scrollable.find('.area').height()- $scrollable.height()- 50){if(request==null&&$scrollable.find('.more-options').length>0){var postData=buildAjaxData();postData['name']=$(this).parents(settings.refineableSelector).attr('id');postData['from']=$scrollable.find('.f-line').length
request=$.ajax({url:settings.moreOptionsUrl,data:JSON.stringify(postData),type:"POST",contentType:'application/json; charset=utf-8',success:function(data){var params=$.deparam.fragment();var urlQ=$.deparam.querystring(uglifyFragment(params['q']));var optionList=generateOptionsHtml(data.d,currentRefinements,urlQ,params);$scrollable.find('.more-options').replaceWith(optionList.join(''));request=null;}});}}});$('.native-scrollable-area').on('click','a.more-options',function(e){e.preventDefault();});if(settings.ajaxEnabled){$this.find('.paging ul a, #current-refines a').click(function(e){e.preventDefault();var qs=$.param.querystring($(this).attr('href'));$.bbq.pushState({q:prettifyFragment(qs)});});$this.on('click','a.page-size, .paging a',function(e){updateRefinables=false;});$this.find('select.page-size').change(function(e){e.preventDefault();$.bbq.pushState(generateUrl('pageSize',$(this).val(),true));});$this.find('select.sortby').change(function(e){e.preventDefault();var params=$.deparam.fragment();var q=$.deparam.querystring(uglifyFragment(params['q']));q['page']=1;q['sortby']=$(this).val();params['q']=prettifyFragment($.param.querystring('',q));$.bbq.pushState(params);});$this.find('input.by-keyword-btn').click(function(e){e.preventDefault();$.bbq.pushState(generateUrl('refineby',$this.find('input.by-keyword-txt').val(),true));});}
$this.find('input.by-keyword-txt').keyup(function(e){if(e.keycode==13){$this.find('input.by-keyword-btn').click();}});$("#dialog-message").dialog({modal:true,buttons:{Ok:function(){$(this).dialog("close");}}});if(settings.ajaxEnabled){var currentFrom=$this.find('input.price-from').val();var currentTo=$this.find('input.price-to').val();var priceSlider=$("#slider-range").slider({range:true,min:$this.find('.price-from').val(),max:$this.find('.price-to').val(),values:[$this.find('.price-from').val(),$this.find('.price-to').val()],change:function(event,ui){updatePrice(ui.values[0],ui.values[1],currentTo);}});function updatePrice(from,to,currentToBackup){if(isNaN(from)||from<0)from=0;if(isNaN(to)||to<0){if(!isNaN(currentToBackup)&&currentToBackup>0)
to=currentToBackup;else
to=0;}
var changed=to!=currentTo||from!=currentFrom;if(to!=currentTo)currentTo=to;if(from!=currentFrom)currentFrom=from;if(changed&&!ignorePriceChange){$this.find('.get-from').text(from);if(to>100){$this.find('.get-to').text('100 over');}else{$this.find('.get-to').text(to);}
var params=$.deparam.fragment();var q=$.deparam.querystring(uglifyFragment(params['q']));q['page']=1;if(from>=0&&to>0&&from<to){if(to>100)q['price']=from+'-max';else q['price']=from+'-'+ to;params['q']=prettifyFragment($.param.querystring('',q));$.bbq.pushState(params);}}
ignorePriceChange=false;}}
$('.view-blok a').click(function(e){e.preventDefault();if(!$(this).hasClass('active')){toggleView();}});var fragment=$.deparam.fragment();if(fragment['v']&&fragment['v']=='grid'){toggleView();}
$this.find('.results-section').on('click','.product-link',function(e){var sku=$(this).parents('div:first').find('.sku').text().trim();var keyword=$('.heading h1 em').text().trim();if(keyword!=undefined&&keyword.length>2){keyword=keyword.substr(1,keyword.length- 2);}else{keyword='';}
keyword+=' '+ $this.find('input.by-keyword-txt').val();nxt_x(encodeURI(keyword.trim()),encodeURI(sku),1);});$this.find('.results-section').on('click','.compare-form a.fake-check',function(e){e.preventDefault();var add=!$(this).hasClass('chk-label-active');$(this).toggleClass('chk-label-active');var refinement=$(this).parents('.refinable').attr('id');var id=$(this).attr('data-value');var image=$this.find('[id="'+ id+'"] .img-column .product-link img').attr('src');updateComparator(id,image,add);if(add){$(this).text('View compare');}else{$(this).text('Compare');}});$this.on('click','.compare-box li a',function(e){e.preventDefault();var id=$(this).attr('id');var $checkbox=$this.find('.compare-check[data-value='+ id+']');$checkbox.click();});function updateComparator(productID,image,add){var compareBtn=$this.find('.btn-compare');var compareQuery=$.deparam.querystring($(compareBtn).attr('href'));var productIDs=new Array();var containsID=false;$this.find('.compare-box li a').each(function(){var currentID=Number($(this).attr('id'));if(currentID>0&&(currentID!=productID||add)){productIDs[productIDs.length]={id:currentID,productImage:$this.find('[id="'+ currentID+'"] .img-column .product-link img').attr('src')};containsID=!containsID&&currentID==productID;}});if(!containsID&&add)productIDs[productIDs.length]={id:Number(productID),productImage:image};sessionStorage[sessionStorage['PageCategory']]=JSON.stringify(productIDs);if(productIDs.length>4){alert('You may only select up to four products to compare');var $checkbox=$this.find('.compare-check[data-value='+ productID+']');$checkbox.parents('.compare-form').find('.chk-label-active').removeClass('chk-label-active');$checkbox.parents('.compare-form').find('.chk-checked').removeClass('chk-checked');}else if(productIDs.length==0){$this.find('.compare-box ul').html('<li></li><li></li><li></li><li></li>');$this.find('.compare-box').slideUp();}else{$this.find('.compare-box').slideDown();var newQuery=new Object();var comparatorHtml='';for(var i=0;i<4;i++){comparatorHtml+='<li>';if(i<productIDs.length){var currentID=productIDs[i].id;newQuery['ProductID'+(i+ 1)]=currentID;comparatorHtml+='<img width="28" height="28" alt="" src="'+ productIDs[i].productImage+'">'
+'<a class="close" href="#" id="'+ currentID+'">close</a>';}
comparatorHtml+='</li>';}
$this.find('.compare-box ul').html(comparatorHtml);$this.find('.compare-box ul li').each(function(){if($(this).find('img').length==1){$(this).css('background-image','none');}});var url=$.param.querystring($(compareBtn).attr('href'),newQuery,2);var returnURL="&ReturnURL="+ $(location).attr('pathname');$(compareBtn).attr('href',url+ returnURL);$('.compare-form a.chk-label-active').attr('href',url+ returnURL);$('.compare-form a.chk-label-active').off().click(function(e){window.location=$(this).attr('href');e.preventDefault();});}}
if(settings.ajaxEnabled){$this.on('click',settings.refineableItemSelector+' a.fake-check',function(e){e.preventDefault();var clickedUrl=$(this).attr('href');$.bbq.pushState(clickedUrl);var addingRefine=!$(this).hasClass('chk-label-active');$(this).toggleClass('chk-label-active');var refinement=$(this).parents('.refinable').attr('id');var val=$(this).attr('data-value');$this.find('#'+ refinement+' a.fake-check').each(function(){var url=$(this).attr('href');var params=$.deparam.fragment(url);var q=$.deparam.querystring(uglifyFragment(params['q']));if(q[refinement]){var options=q[refinement].split('|');var found=-1;for(var i=0;i<options.length;i++){if(options[i]==val){found=i;break;}}
if(found>=0&&!addingRefine||found>=0&&addingRefine&&url==clickedUrl){delete options[found];}else if(found<0&&addingRefine||found<0&&!addingRefine&&url==clickedUrl){options[options.length]=val;}
q[refinement]=options.join('|');}else{q[refinement]=val;}
params['q']=prettifyFragment($.param.querystring('',q));url=$.param.fragment('#',params);$(this).attr('href',url);});});}
$this.on('click','a[href="#popupEmailWhenInStock"]',function(e){$('#popupEmailWhenInStock input[type="textbox"]').val('');$('#popupEmailWhenInStock #emailWhenInStockThanks').addClass('hidden');$('#popupEmailWhenInStock #emailWhenInStockForm').removeClass('hidden');$('#popupEmailWhenInStock .form-row').removeClass('error');$('#popupEmailWhenInStock #hfProdID').val($(this).parents('li').find('input[name="hfProductID"]').val());var title=$(this).parents('li').find('h2').text();$('#popupEmailWhenInStock h2').text(title);});bindEvents(true);if(settings.ajaxEnabled){if($.bbq.getState("q")==undefined||$.bbq.getState("q").length==0){}else if(!queryMatchesFragment()){updateResults();}
$(window).bind("hashchange",function(e){if(!skipUpdate){updateResults();}
skipUpdate=false;});}
$('body').addClass('ajax-list');if(settings.ajaxEnabled){$('body').addClass('ajax-list-enabled');}
return this;function queryMatchesFragment(){var query=$.deparam.querystring();if(!query['page'])query['page']=1;var frag=$.deparam.fragment();if(frag['q']){var qs=uglifyFragment(frag['q']);var frag=$.deparam.querystring(qs);if(!frag['page'])frag['page']=1;}
var match=true;var fragCount=0;var queryCount=0;for(property in frag)fragCount++;for(a in query){queryCount++;var found=false;for(b in frag){if(a==b){found=true;match=query[a]==frag[b];break;}}
if(!match||!found)break;}
return match&&fragCount==queryCount;}
function toggleView(){skipUpdate=true;$('.gridview-wrap .results-list > li> .holder').removeClass('same-height-left').removeClass('same-height-right').css('height','');$('.gridview-wrap').toggleClass('gridview');if($('.gridview-wrap').hasClass('gridview')){$('.gridview').sameHeight({elements:'.results-list > li> .holder',flexible:true,multiLine:true});$('.view-blok .table').addClass('active');$('.view-blok .list').removeClass('active');$.bbq.pushState({v:'grid'});resizePriceH2ToFit();}else{$('.sppYellowBG').removeClass('hideYellowBG');$('.badgeSPP').removeClass('hideYellowBG');$('.view-blok .table').removeClass('active');$('.view-blok .list').addClass('active');$('.gridview-wrap .frame .text-column h2').removeAttr('style');$.bbq.pushState({v:'list'});}}
function buildAjaxData(){var qs=uglifyFragment($.bbq.getState("q"));if(qs.length==0){qs="page=1";}
var q=$.deparam.querystring(qs);if(qs&&qs.length){var page=Number(q.page);if(page==NaN)page=1;var postData={keywords:settings.keywords,page:page,entityName:settings.entityName,entityID:settings.entityID,searchType:settings.searchType,languageCode:$('body').data('language'),query:qs};return postData;}else{return false;}}
function updateResults(){var postData=buildAjaxData();if(postData){if(currentRequest&&currentRequest.readyState!=4){currentRequest.abort();}
showLoading();currentRequest=$.ajax({url:settings.serviceUrl,data:JSON.stringify(postData),type:"POST",contentType:'application/json; charset=utf-8',success:function(data){if(data.d){updateRefinables=true;updateList(data.d);}
hideLoading();},error:function(data){updateRefinables=true;if(data.status>0&&data.status!=200){$this.find(settings.products).html('<li>SEARCH ERROR - please try a new search</li>');}
hideLoading();}});}}
function showLoading(){$this.find(settings.blockedArea).block(settings.blockUISettings);}
function hideLoading(){$this.find(settings.blockedArea).unblock();}
function prettifyFragment(ugly){var qs=$.deparam.querystring(ugly);var pretty='';for(var key in qs){if(pretty.length>0)pretty+="/";pretty+=key+"/"+ qs[key].replace('/','');}
return pretty;}
function uglifyFragment(pretty){var ugly='';if(pretty!=undefined){var parts=pretty.split("/");for(var i=0;i<parts.length;i++){if(ugly.length){if(i%2==0){ugly+='&';}else{ugly+='=';}}
ugly+=encodeURIComponent(parts[i]);}}
return ugly;}
function bindEvents(firstPass,response){if($('.quick-reorder-listing').length>0){$('ul.results-list > li').each(function(e){var inStockNotice='<div class="txt-area" runat="server" id="txtArea">'+ $(this).find('.pricing-column .info-block .txt-area').html()+'</div>';$(this).find('.pricing-column .info-block .txt-area').remove();$(this).find('.text-column h2').after(inStockNotice);if($(this).find('.manufacturer-block').is(':visible')){var manufacturerNotice='<div class="manufacturer-block">'+ $(this).find('.manufacturer-block').html()+'</div>';$(this).find('.manufacturer-block').remove();$(this).find('.text-column h2').after(manufacturerNotice);}});var popupBoxes=$this.find('.quick-reorder-listing .results-list .text-column .txt-area .popup-wrap');var resultItems=$this.find('.results-list > li');var toggleZ=function(item){var boxes=item.find(popupBoxes);var state=!!boxes.filter('.popup-active').length;item.toggleClass('show-popup-state');}
popupBoxes.contentPopup({mode:'click',onShow:function(that){toggleZ(that.holder.closest(resultItems));},onHide:function(that){toggleZ(that.holder.closest(resultItems));}});}
var bindEventsTime=new Date().getTime()
if(!firstPass)bindAddToCart();if(!firstPass){}
if(settings.ajaxEnabled){var minPrice=(response!=undefined)?response.MinPrice:priceSlider.slider("option","min");var maxPrice=(response!=undefined)?response.MaxPrice:priceSlider.slider("option","max");if(maxPrice>100)maxPrice=125;var step=Math.round(maxPrice/5/5)*5;if(minPrice==maxPrice||step<1){$('#priceRefine').hide();}else{$('#priceRefine').show();var from=Number(minPrice);var captionHtml='';while(from<maxPrice){captionHtml+='<span class="txt">$'+ from+'</span> ';from+=step;}
if(maxPrice>100){captionHtml+='<span class="txt txt-last">Over $100</span>';}else{captionHtml+='<span class="txt txt-last">$'+ maxPrice+'</span>';}
$this.find('.price-slider .caption').html(captionHtml);$this.find('.price-slider .caption span').css('width',(100/$this.find('.price-slider .caption span').length)+'%');if(response!=undefined){var hasRange=false;for(var i=0;i<response.CurrentRefinements.length;i++){if(response.CurrentRefinements[i].Name.toLowerCase()=='price'){hasRange=true;priceSlider.slider("option","values",response.CurrentRefinements[i].Value.V.split('-'));break;}}
if(!hasRange){priceSlider.slider("option","values",[priceSlider.slider("option","min"),priceSlider.slider("option","max")]);}}}}
var page=1;var qs=uglifyFragment($.bbq.getState("q"));if(qs&&qs.length||!settings.ajaxEnabled){var q=(settings.ajaxEnabled)?$.deparam.querystring(qs):$.deparam.querystring();if(q){if(q['page'])page=q['page']*1;if(q['pageSize']&&Number(q['pageSize'])!=NaN){var pageSize=Number(q['pageSize']);var sizeLink=$this.find('a.page-size');if(pageSize!=24&&pageSize>0){$(sizeLink).text('View 24 Items Per Page');$(sizeLink).attr('href',$.param.querystring($(sizeLink).attr('href'),{pageSize:24}));$this.find('select.page-size').val(100);$this.find('.paging .select-sort .center').text(100);}else{$(sizeLink).text('View 100 Items Per Page');$(sizeLink).attr('href',$.param.querystring($(sizeLink).attr('href'),{pageSize:100}));$this.find('select.page-size').val(24);$this.find('.paging .select-sort .center').text(24);}}}}
$this.find('.paging ul').each(function(){var total=$(this).find('li').length;if(total<=1){$this.find('.paging').hide();$('.drop-page-size .drop-holder').attr('style','display:none !important');}else{$this.find('.paging').show();var trimmedStart=false;var trimmedEnd=false;$(this).find('li').each(function(i){var current=i+ 1;if(current==1||current==total||current==page||(current>=(page- 4)&&current<=(page+ 4))){$(this).find('a').removeClass('hidePage');$(this).show();}else{$(this).hide();if(!trimmedStart&&current<page)trimmedStart=true;if(!trimmedEnd&&current>page)trimmedEnd=true;}
if(current==page){$(this).html('<strong>'+ page+'</strong>');}});if(trimmedStart){$(this).find('li').first().after('<li><span>...</span></li>')}
if(trimmedEnd){$(this).find('li').last().before('<li><span>...</span></li>')}
if(page>1){var url=generateUrl('page',page- 1);$(this).prepend('<li class="prev"><a href="'+ url+'">prev</a></li>');}
if(page<total){var url=generateUrl('page',page+ 1);$(this).append('<li class="next"><a href="'+ url+'">next</a></li>');}}});$this.find('.autocomplete-list').val('');$this.find('.autocomplete-list').each(function(){var source=Array();$(this).parents('.refinable').find('.f-line a').each(function(){source[source.length]={label:$(this).text().trim(),value:$(this).attr('href').trim()};});if(source.length>10&&settings.ajaxEnabled){var auto=$(this).autocomplete({source:source,select:function(e,ui){if($('body').hasClass('ajax-list')){$.bbq.pushState(ui.item.value);}else{$.bbq.pushState({q:prettifyFragment($.param.querystring(ui.item.value))});}
e.preventDefault();},focus:function(e,ui){auto.val(ui.item.label);e.preventDefault();},});$(this).parents('.refine-autocomplete').show();}else{$(this).parents('.refine-autocomplete').hide();}});if($this.find('#current-refines').html().trim().length>66){$this.find('.current-filter').fadeIn();}else{$this.find('.current-filter').hide();}
if($this.find('#results-messages').html().trim().length>0){$this.find('#results-messages').fadeIn();}else{$this.find('#results-messages').hide();}
if($this.find('#results-messages').has('.no-padding').length>0){$this.find('#results-messages').css('padding','0px');$this.find('#results-messages .ajax-message > div').css('padding','10px');}else{$this.find('#results-messages').css('padding','');$this.find('#results-messages .ajax-message > div').css('padding','');}
$('.ajax-message').has('div').css('padding','10px');if(settings.ajaxEnabled){$this.find(settings.refineableSelector+' input[type="checkbox"], '+ settings.refineableSelector+' input[type="radio"]').change(function(e){e.preventDefault();var link=$(this).parents('.f-line').find('a');var fragment=$.param.fragment($(link).attr('href'));var qs=$.param.querystring($(link).attr('href'));if($.deparam.fragment(fragment)['q']!=undefined){$.bbq.pushState(fragment);}else{$.bbq.pushState({q:prettifyFragment(qs)});}});}
if($('.gridview-wrap').hasClass('gridview')){$('.gridview').sameHeight({elements:'.results-list > li> .holder',flexible:true,multiLine:true});}
else{}
if(!firstPass){jQuery('.popup-holder').openClose({hideOnClickOutside:true,activeClass:'active',opener:'.open',slider:'.popup',animSpeed:400,event:'over',effect:'none'});var popupBoxes=$this.find('.popup-wrap,.discount-popup');var resultItems=$this.find('.results-list > li');var toggleZ=function(item){var boxes=item.find(popupBoxes);var state=!!boxes.filter('.popup-active').length;item.toggleClass('show-popup-state');}
popupBoxes.contentPopup({mode:'click',onShow:function(that){toggleZ(that.holder.closest(resultItems));},onHide:function(that){toggleZ(that.holder.closest(resultItems));}});initLightbox();$('.b-block .popup-wrap .popup').removeClass('js-slide-hidden');}
$this.find('.paging').last().find('a').click(function(){window.scrollTo(0,$(".heading").offset().top);});$this.find('.reviews-count:contains("(0)")').parents('.reviews-block').hide();}
function generateUrl(name,value,resetPage){if(settings.ajaxEnabled){var params=$.deparam.fragment();var q=$.deparam.querystring(uglifyFragment(params['q']));q[name]=value;if(resetPage)q['page']=1;params['q']=prettifyFragment($.param.querystring('',q));var url=$.param.fragment('#',params);return url;}else{var q=$.deparam.querystring();q[name]=value;if(resetPage)q['page']=1;var url=$.param.querystring('?',q);return url}}
function removeFirstSlash(url){var i=url.indexOf('/');if(i==0&&url.length>1){url=url.substring(1,url.length);}
i=url.indexOf('&');if(i==0&&url.length>1){url=url.substring(1,url.length);}
return url;}
function removeLanguageCode(url){var result=url.replace("LanguageCode/EN","").replace("LanguageCode=EN","").replace("LanguageCode/FR","").replace("LanguageCode=FR","").replace("LanguageCode/ES","").replace("LanguageCode=ES","").replace("LanguageCode/ZH","").replace("LanguageCode=ZH","").replace("LanguageCode/KO","").replace("LanguageCode=KO","").replace("LanguageCode/IT","").replace("LanguageCode=IT","").replace("LanguageCode/JA","").replace("LanguageCode=JA","");return removeFirstSlash(result);}
function generateUrlForRel(url,direction){if($('head').html().indexOf('rel="'+ direction+'"')<0){var finalurl=window.location.pathname+'#q='+ encodeURIComponent(url).replace(/%20/g,'+').replace(/%2F/g,'/');var directionLink='<link href="'+ removeLanguageCode(finalurl)+'" rel="'+ direction+'" />';$('head').append(directionLink);}
else{var finalurl='';if(direction=='canonical'){finalurl='https://'+ window.location.hostname+ window.location.pathname+'#q='+ encodeURIComponent(removeLanguageCode(url)).replace(/%20/g,'+').replace(/%2F/g,'/');}
else{finalurl=window.location.pathname+'#q='+ encodeURIComponent(url).replace(/%20/g,'+').replace(/%2F/g,'/');}
var directionLink='<link href="'+ finalurl+'" rel="'+ direction+'" />';var elem=$("link[rel*='"+ direction+"']");elem.attr('href',finalurl);}}
function generateUrlForRelX(url,direction){if($('head').html().indexOf('rel="'+ direction+'"')<0){var finalurl=window.location.pathname+'#q='+ encodeURIComponent(url).replace(/%20/g,'+').replace(/%2F/g,'/');var directionLink='<link href="'+ removeLanguageCode(finalurl)+'" rel="'+ direction+'" />';$('head').append(directionLink);}
else{var finalurl='';if(direction=='canonical'){finalurl='https://'+ window.location.hostname+ window.location.pathname+'#q='+ encodeURIComponent(removeLanguageCode(url)).replace(/%20/g,'+').replace(/%2F/g,'/');}
else{finalurl=window.location.pathname+'#q='+ encodeURIComponent(url).replace(/%20/g,'+').replace(/%2F/g,'/');}
var directionLink='<link href="'+ finalurl+'" rel="'+ direction+'" />';var elem=$("link[rel*='"+ direction+"']");elem.attr('href',finalurl);}}
function generateUrlForLan(url,direction){var lang=direction;if(direction=='en'||direction=='x-default')
lang='www';sPageName=getPageName(window.location.pathname).toLowerCase();href="https://"+ lang+".luckyvitamin.com/"+ sPageName+"#q="+ removeLanguageCode(url);href=href.replace(' ','+').replace(' ','+').replace(' ','+');var directionLink='<link rel="alternate" href="'+ href+'"  hreflang ='+ direction+'  />';if($('head').html().indexOf('hreflang="'+ direction+'"')<0){$('head').append(directionLink);}
else{var elem=$("link[hreflang*='"+ direction+"']");elem.attr('href',href);}}
function generateUrlForMobile(url,direction){var sLoc='';if($.cookie("LuckyVitaminCountry")!='')
sLoc='/filter?loc='+ $.cookie("LuckyVitaminCountry").toUpperCase()+'&';var sPageName=getPageName(window.location.pathname).toLowerCase();var finalurl='https://m.luckyvitamin.com/'+ sPageName+ sLoc+ removeLanguageCode(url);var directionLink='<link href="'+ finalurl+'" rel="'+ direction+'" />';if($('head').html().indexOf('rel="'+ direction+'"')<0){$('head').append(directionLink);}
else{var elem=$("link[rel*='"+ direction+"']");elem.attr('href',finalurl);}}
function selectRefineable(el){$(el).find('a').addClass('chk-label-active');}
function deSelectRefineable(el){$(el).find('a').removeClass('chk-label-active');}
function updateRelLinks(totalPages){var qs=uglifyFragment($.bbq.getState("q"));var pg=1;var prevPg=1;var nextPg=1;if(qs&&qs.length||!settings.ajaxEnabled){var q=(settings.ajaxEnabled)?$.deparam.querystring(qs):$.deparam.querystring();var params=$.deparam.fragment();var urlQ=$.deparam.querystring(uglifyFragment(params['q']));var urlP=prettifyFragment($.param.querystring('',$.deparam.querystring(uglifyFragment(params['q']))));var url='';urlQ['page']=1;url=prettifyFragment($.param.querystring('',urlQ));generateUrlForMobile(qs,'alternate');generateUrlForRelX(url,'canonical');$.each(['ko','ja','zh','en','es','x-default','it','fr'],function(index,value){generateUrlForLan(urlP,value);});if(q){if(q['page']){pg=q['page']*1;}
if(pg>1){urlQ['page']=pg- 1;url=prettifyFragment($.param.querystring('',urlQ));generateUrlForRel(url,'prev','');}
else{$("link[rel*='prev']").remove();}
if(pg<totalPages){urlQ['page']=pg+ 1;url=prettifyFragment($.param.querystring('',urlQ));generateUrlForRel(url,'next','');}
else{$("link[rel*='next']").remove();}}}}
function updateList(response){var updateListTime=new Date().getTime();updateRelLinks(response.TotalPages);jcf.customForms.destroyAll(settings.itemSelector);$this.find('.results-section .section-heading h1').html('<i>We found</i> <b>'+ $.number(response.TotalProducts)+' Result'+((response.TotalProducts!=1)?'s':'')+'</b>');$('#aisle7-product-count').text(response.TotalProducts);$this.find('.results-section .section-heading .showing').html('Showing <span class="from-item">'+ response.FromProduct+'</span>-'+ response.ToProduct);currentRefinements=response.CurrentRefinements;var products=new Array();var catName=$('#sppCategoryName').val()+'';for(var i=0;i<response.Products.length;i++){var $item=$($(itemTemplate).clone());var prod=response.Products[i];if(catName.length>0)
{if($('#sppShowAvailabilityCount').val()=='1')
{if(prod.Inventory<1||prod.Inventory>9)
{$item.find('div.sppAvailabilityCount').html('');$item.find('div.sppAvailabilityCount').attr('style','background:none !important');}
else
$item.find('div.sppAvailabilityCount').html('<div>ONLY <span>'+ prod.Inventory+'</span> LEFT</div>');}
else
{$item.find('div.sppAvailabilityCount').html('');$item.find('div.sppAvailabilityCount').attr('style','background:none !important');}}else{$item.find('div.sppAvailabilityCount').attr('style','display:none !important');}
$item.attr('id',prod.ID);$item.css('z-index','auto');if(prod.isSPPItem&&!prod.IsTooLow)
if($item.find('.badgeSPP').length>0)
$item.find('.badgeSPP span').html(prod.SavePercent+'%<span>OFF</span>');else{var sSPPDiv='<div id="spnBadge" class="badgeSPP"><span>'+ prod.SavePercent+'%<span>OFF</span></span></div>';$item.find('.img-column').prepend(sSPPDiv);}
else
$item.find('.badgeSPP').attr('style','display:none');$item.find('a.product-link').attr({'href':prod.Link,'title':prod.Name});if(i<=4){$item.find('.img-column a.product-link img').attr('src',prod.Img).removeClass('lazy');}else{$item.find('.img-column a.product-link img.lazy').attr('data-original',prod.Img).attr('src',rewritePathForCDN('images/spinner.gif'));}
$item.find('h2 a.product-link').html('<span class="tag manufacturer">'+ prod.Manufacturer+'</span>'+ prod.Name);if(prod.MSRP==0||prod.MSRP<=prod.Price){$item.find('.msrp').remove();}else{$item.find('.msrp').html('<span class="sppMSRP">MSRP: </span>'+ prod.LocaleMSRP);}
if(prod.IsTooLow){$item.find('.usualy, .usualPrice, .new-price,.save-count, .per-serving, .per-servingsize, .special-block').remove();$item.find('.toolowprice').attr('href','previewCart?ProductID='+ prod.ID);$item.find('.lower-price').attr('href','previewCart?ProductID='+ prod.ID);}else{$item.find('.tooLowQM').remove();$item.find('.lower-price').remove();$item.find('.toolowprice').remove();if(prod.PreviousPrice>0&&prod.PreviousPrice>prod.Price){$item.find('.usualPrice').html('<span class="sppMSRP">Usually: </span>'+ prod.LocalePreviousPrice);}else{$item.find('.usualPrice').remove();if(prod.MSRP>0)
$item.find('.msrp').html(prod.LocaleMSRP);$item.find('.usualy').remove();}
$item.find('.selling-price span').text(prod.LocalePrice);if(prod.SavePercent>0){$item.find('.save-percent').text($.number(prod.SavePercent,0));}
else{$item.find('.save-count').hide();}
if(prod.ServingPrice>0){$item.find('.per-serving').text('Per Serving: '+ prod.LocaleServingPrice);}else{$item.find('.per-serving').remove();}
if(prod.DosageSize>0&&prod.DosageFormName!=''&&!($('.gridview-wrap').hasClass('gridview'))){$item.find('.per-servingsize').text('Serving Size: '+ $.number(prod.DosageSize,2)+' '+ prod.DosageFormName);}else{$item.find('.per-servingsize').remove();}}
$item.find('.reviews-count').text('('+ prod.TotalRatings+')');$item.find('.sku').text(prod.SKU);$item.find('.reward-points').text(prod.Points);$item.find('.rating').css('width',(prod.Rating*20)+'%');$item.find('.ingredients').html('');$item.find('.tag-pos').removeClass('hot-pos').removeClass('new-pos').removeClass('sale-pos');$item.find('.compare-check').attr('data-value',prod.ID);$item.find('input[name=hfProductID]').val(prod.ID);$item.find('input[name=hfVariantID]').val(prod.VarID);$item.find('input[name=hfShoppingCartRecID]').val(prod.RecID);$item.find('.qr-remove-item').attr('data-item-sku',prod.SKU);$item.find('.qr-quantity').text(prod.CISQuantity);$item.find('.qr-lastordered').text(prod.CISLastOrdered);if(prod.OnSale&&settings.entityID!=top100BestSellersCategoryID){$item.find('.tag-pos').addClass('sale-pos');}else{$item.find('.usualy, .special-block').remove();}
if(prod.IsHot){$item.find('.tag-pos').addClass('hot-pos');}else if(prod.IsNew){$item.find('.tag-pos').addClass('new-pos');}
if(prod.isSPPItem&&prod.Price<prod.MSRP&&!prod.IsTooLow){$item.find('.qr-lastordered').text(prod.CISLastOrdered);$item.find('.sppYellowBG').addClass('showYellowBG');$('.badgeSPP').removeClass('showYellowBG');}
if(prod.SuppressAddToCart){$item.find('.in-stock').remove();$item.find('.back-ordered').remove();$item.find('.in-stock-message').remove();$item.find('.back-ordered-message').remove();$item.find('.AddToCartButton').addClass('hidden');$item.find('.SuppressAddToCart').removeClass('hidden');$item.find(".txt-area").css('display','none');$item.find(".manufacturer-block").css('display','block');$item.find(".email-out-block").css('display','block');$item.find(".qty-form").css('display','none');$item.find(".cart-line").css('display','none');$item.find(".cart-line").parent().parent().addClass("reward-pop-block-wrap");}else{$item.find(".cart-line").parent().parent().removeClass("reward-pop-block-wrap");$item.find('.AddToCartButton').removeClass('hidden');$item.find('.SuppressAddToCart').addClass('hidden');$item.find('.out-of-stock').remove();$item.find('.out-of-stock-message').remove();$item.find(".txt-area").css('display','block');$item.find(".manufacturer-block").css('display','none');$item.find(".email-out-block").css('display','none');$item.find(".qty-form").css('display','block');$item.find(".cart-line").css('display','block');if(prod.InStock){$item.find('.back-ordered').remove();$item.find('.back-ordered-message').remove();if(prod.ExStock){if($('#sppCategoryName').val().length==0)
$item.find('.in-stock span').text(prod.Inventory+" ");}else{$item.find('.in-stock span').remove();}}else{$item.find('.in-stock').remove();$item.find('.in-stock-message').remove();if(prod.BackOrderedNoDate){$item.find('.back-ordered span,.back-ordered-message span').text("No ship date");}else{var days=5;if(prod.LeadTime>0)days=prod.LeadTime+ 2;$item.find('.back-ordered span,.back-ordered-message span').text("2-"+ days+" days");}
if(settings.allowBackOrder==0){$item.find(".pricing-column.add-to-cart-fields").addClass('reward-pop-block-wrap');$item.find(".backorder-block").css('display','block');$item.find(".email-out-block").css('display','block');$item.find(".txt-area").css('display','none');$item.find(".qty-form").css('display','none');$item.find(".cart-line").css('display','none');}}}
$item.find('a.AddToCartButton i.ico').attr('class','ico '+ prod.ID);$item.find('a.AddToCartButton span.atc-text').attr('class','atc-text '+ prod.ID);if(settings.sections!=undefined){for(var j=0;j<prod.SectionIDs.length;j++){for(var k=0;k<settings.sections.length;k++){if(settings.sections[k].ID==prod.SectionIDs[j]){var specialty=$(specialtyTemplate).clone();$(specialty).css('background-image','url("'+ settings.sections[k].Image+'")');$(specialty).css('background-position','center 10px');$(specialty).find('a.open').attr('href',settings.sections[k].Link);$(specialty).find('.popup .holder').html('<h3><a href="'+ settings.sections[k].Link+'">'+ settings.sections[k].Name+'<a></h3>');$(specialty).find('.popup .holder').append(settings.sections[k].Name);$item.find('.ingredients').append(specialty);}}}}
var promoTemplate=$item.find('.description-area .limited-row').clone();$item.find('.description-area').html('');for(var j=0;j<prod.Promotions.length;j++){var promo=$(promoTemplate).clone();$(promo).find('.promo-name').text(prod.Promotions[j].Name);$(promo).find('.promo-msg').text(prod.Promotions[j].Msg);$item.find('.description-area').append(promo);}
var sPageName=getPageName(window.location.pathname).toLowerCase();if(sPageName.substr(0,4)=='my-w')
$item.find('.og-offer').replaceWith('<div class="og-offer" data-og-module="wishlist" data-og-product="'+ prod.SKU+'"></div>');else{$item.find('.og-offer').replaceWith('<div class="og-offer" data-og-module="category" data-og-product="'+ prod.SKU+'"></div>');if(prod.SuppressAddToCart){$item.find(".og-offer").css('display','none');$item.find(".og-offer").next('.info-block').addClass('list-info-block');}
else{$item.find(".og-offer").next('.info-block').removeClass('list-info-block');}}
products.push($item[0].outerHTML);}
$this.find(settings.products).parent()[0].innerHTML='<ul id="search-results" class="results-list">'+ products.join('')+'</ul>';fixListingCadDisplay();resizePriceH2ToFit();$this.find(settings.refineableSelector).each(function(){var time=new Date().getTime();var name=$(this).attr('id').toLowerCase();var found=false;var params=$.deparam.fragment();var urlQ=$.deparam.querystring(uglifyFragment(params['q']));if(response.CurrentRefinements.length==0){var permitted={'pageSize':false,'page':false,'sortby':false};var lostRefines=false;for(var key in urlQ){var isPermitted=false;for(var permittedKey in permitted){if(permittedKey==key){isPermitted=true;permitted[permittedKey]=urlQ[key];}}
if(!isPermitted){lostRefines=true;delete urlQ[key];}}
if(lostRefines){skipUpdate=true;$.bbq.pushState({q:prettifyFragment($.param.querystring('',urlQ))});}}
for(var i=0;i<response.Refinables.length&&updateRefinables;i++){var refinable=response.Refinables[i];if(refinable.Name.toLowerCase()==name){found=true;var $options=$($(this).find('.f-line'));var optionList=generateOptionsHtml(refinable,response.CurrentRefinements,urlQ,params);if(name!='rating'){if(refinable.Total>optionList.length){optionList.push('<a href="#" class="more-options">Show All</a>');}
$(this).find('.native-scrollable-area')[0].innerHTML='<div class="area">'+ optionList.join('')+'</div>';}else{$(this).find('.rating-block')[0].innerHTML=optionList.join('');}
break;}}
if(updateRefinables){if(found)$(this).show();else $(this).hide();}});ignorePriceChange=true;priceSlider.slider("option","min",response.MinPrice);if(response.MaxPrice>100){priceSlider.slider("option","max",125);}else{priceSlider.slider("option","max",response.MaxPrice);}
var paging='';for(var i=1;i<=response.TotalPages;i++){var url=generateUrl('page',i);paging+='<li><a href="'+ url+'">'+ i+'</a></li>';}
$this.find('.paging ul').html(paging);var refinesHtml='';for(var i=0;i<response.CurrentRefinements.length;i++){var refinement=response.CurrentRefinements[i];for(var j=0;j<refinement.Options.length;j++){var val=refinement.Options[j].V;var params=$.deparam.fragment();var q=$.deparam.querystring(uglifyFragment(params['q']));q['page']=1;var current=q[refinement.Name];if(current==undefined)current=q[refinement.Name.toLowerCase()];current=current.split('|');q[refinement.Name]='';for(var k=0;k<current.length;k++){if(current[k]!=val){if(q[refinement.Name].length>0)q[refinement.Name]+='|';q[refinement.Name]+=current[k];}}
if(q[refinement.Name]==''){delete q[refinement.Name];}
params['q']=prettifyFragment($.param.querystring('',q));var url=$.param.fragment('#',params);var name=val;if(refinement.Name.toLowerCase()=='rating'){if(val==5){name=val;}
else{name=val+" &amp; up ";}
name="Rating: "+ name;}else if(refinement.Options[j].N){name=refinement.Options[j].N;}
refinesHtml+=' <a href="'+ url+'">'+ name+'<span>del</span></a>';}}
if(response.CurrentRefinements.length>0){var url='#q=page/1';refinesHtml+='<a href="'+ url+'" class="'+'clearall">Clear All<span>del</span></a>'}
$this.find('#current-refines').html(refinesHtml);$('#results-messages').find('.ajax-message').remove();var messageHtml='';for(var i=0;i<response.Messages.length;i++){if(response.Messages[i].ContentType==1){messageHtml+='<div class="ajax-message">'
+ response.Messages[i].Content+'</div>';}}
if(messageHtml.length>0){$('#results-messages').append(messageHtml).fadeIn();}else{$('#results-messages').hide();}
$this.find('.compare-box ul').html('');$this.find('.compare-box').hide();if(sessionStorage['PageCategory']!=undefined){var productsString=sessionStorage[sessionStorage['PageCategory']];if(productsString!=undefined){var compareproducts=JSON.parse(productsString);for(i=0;i<compareproducts.length;i++){updateComparator(compareproducts[i].id,compareproducts[i].productImage,true);}}}
if(typeof utag_data!='undefined'){var vProdSKUList="[";for(i=0;i<products.length;i++){if(i>0){vProdSKUList+=","+ products[i][0].id;}
else{vProdSKUList+=products[i][0].id;}}
vProdSKUList+="]";utag_data.product_sku=vProdSKUList;var page_full_name="";if(utag_data.page_type=='category'){page_full_name=utag_data.page_category_name+" page "+ response.Page.toString();}
if(utag_data.page_type=='manufacturer'){page_full_name=utag_data.page_manufacture_name+" page "+ response.Page.toString();}
if(utag_data.page_type=='brand'){page_full_name=utag_data.page_brand_name+" page "+ response.Page.toString();}
if(utag_data.page_type=='search'){page_full_name="search page "+ response.Page.toString();}
utag_data.page_name=page_full_name;}
initLazyLoad();bindEvents(false,response);var scrollToTop=!$('#aboutTheBrand').hasClass('active');if(scrollToTop)
window.scrollTo(0,$(".heading").offset().top);}
function generateOptionsHtml(refinable,currentRefinements,urlQ,params){var optionList=new Array();for(var j=0;j<refinable.Options.length;j++){var q=JSON.parse(JSON.stringify(urlQ));q['page']=1;var optionValue=refinable.Options[j].V;var optionName=refinable.Options[j].N;if(optionName==null||!optionName||optionName.length==0)optionName=optionValue;var optionCount=refinable.Options[j].C;var isCurrent=false;for(var x=0;x<currentRefinements.length;x++){var refinement=currentRefinements[x];if(refinement.Name.toLowerCase()==refinable.Name.toLowerCase()){for(var y=0;y<refinement.Options.length;y++){if(refinement.Options[y].V==optionValue){isCurrent=true;break;}}
break;}}
if(!q[refinable.Name]||q[refinable.Name].length==0||!refinable.AllowMultiples){q[refinable.Name]=optionValue;}else if(isCurrent){var optionsLessCurrent=q[refinable.Name].split('|');optionsLessCurrent=$.grep(optionsLessCurrent,function(n,i){return n!=optionValue;});if(optionsLessCurrent.length==0){delete q[refinable.Name];}else{q[refinable.Name]=optionsLessCurrent.join('|');}}else{q[refinable.Name]+='|'+ optionValue;}
params['q']=prettifyFragment($.param.querystring('',q));var url=$.param.fragment('#',params);var $item;if(refinable.Name.toLowerCase()!='rating'){$item=$($(refineableTemplate).clone());$item.find('a').attr('href',url).attr('data-value',optionValue);if(refinable.Name.toLowerCase()=='color'){$item.find('a').html(optionName+' ('+ optionCount+')');}else{$item.find('a').text(optionName+' ('+ optionCount+')');}
$item.find('a').attr('href',url);$item.find('a').attr('rel','');if(ApplyNoFollowRules(url,refinable.Name.toLowerCase()))
{$item.find('a').attr('rel','nofollow');}}else{$item=$(ratingTemplate).clone();$item.find('a').attr('href',url);$item.find('.rating-value').text(optionName);$item.find('.rating-count').text(optionCount);$item.find('.rating').css('width',(optionName*20)+'%');}
if(isCurrent){selectRefineable($item);}else{deSelectRefineable($item);}
optionList.push($item[0].outerHTML);}
return optionList;}
function ApplyNoFollowRules(link,refinable)
{var nofollow=false;var permitted=['category','brand','healthconcern','goal','specialty'];var isPermitted=false;for(var i=0;i<permitted.length;i++){if(permitted[i]===refinable){isPermitted=true;break;}}
if(refinable.length>0&&isPermitted){var query;var params=$.deparam.fragment(link);var qs=uglifyFragment(params['q']);var q=$.deparam.querystring(qs);var booUrlContainsNonPermittedRefines=0;for(var key in q){if($.inArray(key.toLowerCase(),permitted)<0&&key.toLowerCase()!='page'&&key.toLowerCase()!='pagesize')
booUrlContainsNonPermittedRefines++;}
if(booUrlContainsNonPermittedRefines>0)
{nofollow=true;}
else
{var categoryRefinements=0;var otherRefinements=0;for(var key in q){var count=q[key].split('|').length;if(key.toLowerCase()!='page'&&key.toLowerCase()!='pagesize'){if(key.toLowerCase()=='category'){categoryRefinements=count;if(count>1)otherRefinements+=count- 1;}
else{otherRefinements+=count;}}}
if(otherRefinements>1||categoryRefinements>2){nofollow=true;}}}
else{nofollow=true;}
return nofollow;}};}(jQuery));function doSearch(){var fileName=$('.search-form input[type="text"]').val();if($('body').data('language').toUpperCase()!='EN'){fileName=encodeURI(fileName);}else{fileName=fileName.replace(/[^a-zA-Z 0-9]+/g,'').replace(/^\s+|\s+$/g,"");}
fileName='sb-'+fileName.replace(new RegExp(" ","g"),"-");if(fileName.length>3)window.location=fileName;}
function startChatLink(){if($('#supportCodeButton a')){var correctChatLink=$('#supportCodeButton a').attr('href');$('a[href="javascript:startChat(0)"]').each(function(){$(this).attr('href',correctChatLink);});}}
function getParameterByName(name){name=name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var regex=new RegExp("[\\?&]"+ name+"=([^&#]*)"),results=regex.exec(location.search);return results==null?"":decodeURIComponent(results[1].replace(/\+/g," "));}
function resizePriceH2ToFit(){if($('.gridview-wrap').hasClass('gridview')){$('.sppYellowBG').addClass('hideYellowBG');var nCount=$('.gridview .text-column h2').length;var nCurrentStartItem=1;$('.gridview .text-column h2').each(function(){if((nCurrentStartItem==1||nCurrentStartItem%3==1)&&(nCurrentStartItem<nCount)){var nLeftCellHeight=$(this).height();var nMiddleCellHeight=0;var nRightCellHeight=0;if($(this).closest('li').next('li').find('h2').length>0)
nMiddleCellHeight=$(this).closest('li').next('li').find('h2').height();if($(this).closest('li').next('li').next('li').find('h2').length>0)
nRightCellHeight=$(this).closest('li').next('li').next('li').find('h2').height();var nMaxHeight=Math.max(nLeftCellHeight,nMiddleCellHeight,nRightCellHeight);$(this).css('height',nMaxHeight+'px');if($(this).closest('li').next('li').find('h2').length>0)
$(this).closest('li').next('li').find('h2').css('height',nMaxHeight+'px');if($(this).closest('li').next('li').next('li').find('h2').length>0)
$(this).closest('li').next('li').next('li').find('h2').css('height',nMaxHeight+'px');}
nCurrentStartItem++;});}}
$(document).ready(function(){if($('.okToFollow').length>0)
{$('.okToFollow').each(function(){$(this).removeAttr("rel");$(this).removeClass("okToFollow");});}
if($('.order-confirmation .content-banner').children().length==0){$('.order-confirmation .content-banner').remove();}
resizePriceH2ToFit();if($('div.related-list.horizontal div.br-sf-widget').length>0){$('div.br-sf-widget:eq(2)').addClass("noRightBorder");}
$('.sppListing .sppAvailabilityCount').each(function(){if($(this).text()==''){$(this).removeClass('sppAvailabilityCount');}});var maxHeight=0;$('.item.spnItemName').each(function(){maxHeight=maxHeight>$(this).height()?maxHeight:$(this).height();});if(maxHeight==0)
maxHeight=42;$('.item.spnItemName').height(maxHeight);var fullURL=parent.document.URL;if((fullURL.indexOf('writeReview=1')>-1)&&($('isRegistered'))){$('#btnReviewProduct').click();}
if($('.drop-page-size .drop-holder').length>0){var total=0;$('.paging ul').each(function(){total=$(this).find('li').length;});if(total<=1){$('.drop-page-size .drop-holder').attr('style','display:none !important');}}
$('#div360 a').click(function(event){$('#div360').hide();$('.MagicZoomPlus').show();});$('#drag-image').click(function(event){$('#div360').show();$('.MagicZoomPlus').hide();});$('.enlarge-image, .rollover-image').click(function(event){$('#div360').hide();$('.MagicZoomPlus').show();});if(!$('#btnPayPal').is(':enabled'))
{$('#btnPayPal').attr('style','cursor:default');$('#btnPayPal').addClass('grayscale');}
var vars=[],hash;var query=document.URL.split('?')[1];if(query!=undefined){var q=query.substring(0,query.indexOf('#'));if(q!=undefined){q=q.split('&');for(var i=0;i<q.length;i++){hash=q[i].split('=');vars.push(hash[1]);vars[hash[0]]=hash[1];}}}
if(vars.length>0&&vars['sort']!=undefined){$("#sort-reviews").val(vars['sort']);}
var sortbyComponent=decodeURIComponent(document.URL.split('sortby/')[1]);if(sortbyComponent!='undefined'&&sortbyComponent!=''){$('.sortby option').each(function(){if(sortbyComponent.indexOf($(this).val())>=0){$(this).attr('selected','selected');}});}
$('.select-sortby > .center').text($('.sortby option:selected').text());var test=$('#sort-reviews').closest(".sort-form").find('.select-area > .center');test.text($('#sort-reviews :selected').text());$('#reviews .paging li a').click(function(e){if(vars.length>0&&vars['sort']!=undefined){e.preventDefault();var mainUrl=document.URL.split('?')[0];var href=$(this).attr('href');var qPage=href.substring(0,href.indexOf('#'));window.location=mainUrl+ qPage+'&sort='+ vars['sort']+'#reviews';}});function toggleRewardPointsDetail(section,buttonToggle){$(section).toggle();var mode=$(section).css('display');if(mode=='block'){$(buttonToggle).text('Collapse Detail');}else{$(buttonToggle).text('Expand for Detail');}}
$('.expand-reward-points').click(function(e){e.preventDefault();var section=$('.reward-points-detail');toggleRewardPointsDetail(section,$(this));});$('.expand-gift-card-funds').click(function(e){e.preventDefault();var section=$('.gift-card-fund-detail');toggleRewardPointsDetail(section,$(this));});$('.products-listview').on('click','.quantity-minus,.quantity-plus',function(e){e.preventDefault();e.stopImmediatePropagation();var quantityBox=$(this).closest('.input-holder').find('.quantity-box');var qty=$(quantityBox).val()*1;if(qty==NaN||qty<=0)qty=1;if($(this).text()=='+'){qty++;}else{qty--;}
if(qty<=0){qty=1;}
$(quantityBox).val(qty);});$('body').on('click','.qr-remove-item',function(e){e.preventDefault();var sku=$(this).data('item-sku');var parentListItem=$(this).parents('li');$.ajax({type:"POST",url:"ActionService.asmx/RemoveQuickReorderItem",data:"{\"sku\":\""+ sku+"\"}",contentType:"application/json; charset=utf-8",dataType:"json",success:function(Data){var obj=jQuery.parseJSON(Data.d);parentListItem.hide();},failure:function(msg){}});});$('.closepopup').on('click',function(){jQuery.fancybox.close();});});function shippingPopup(){$('#btnPopupShippingOptions').click();}
function initOmnicaFancyDropdowns(){$('.products-listview').addClass('dropdowns-initialised');$('.products-listview .results-list .delivery-form .select-delivery').removeClass('hidden');$('.products-listview .results-list .delivery-form .drop-delivery').removeClass('hidden');var isTouchDevice=jcf.isTouchDevice||jcf.isWinPhoneDevice;if(isTouchDevice){$('.products-listview .results-list .delivery-form .popup').remove();$('.products-listview .results-list .delivery-form').addClass('touch-device');}
$('.products-listview').on('change','.results-list .delivery-form select',function(e){$(this).parents('.delivery-form').find('.popup-wrap .jcf-unselectable .center').text($(this).find('option:selected').text());});$('.products-listview').on('click','.results-list .delivery-form .popup li a',function(e){e.preventDefault();$(this).parents('.delivery-form').find('select').val($(this).attr('data-value'));$(this).parents('.delivery-form').find('.popup-wrap .jcf-unselectable .center').text($(this).text());$(this).parents('.delivery-form').find('.popup-wrap').removeClass('popup-active');$(this).parents('.delivery-form').find('.popup-wrap .popup').hide();});$('form').on('load','.add-loading',function(e){if(!$('.add-loading').is(':enabled')){$('.add-loading').attr('style','cursor:default');$('.add-loading').fadeTo(500,0.2);}});$('form').on('click','.add-loading',function(e){if($(this).is(':enabled')){$(this).find('.arrow').hide();$(this).find('.text').text('PROCESSING...');$(this).blur().addClass('btn-loading');if($(this).hasClass('int-button')){$(this).prop('disabled',true);}}else if($(this).hasClass('int-button')){e.preventDefault();return false;}});$('.int-button').click(function(e){if($(this).hasClass('loading')){e.preventDefault();return false;}});$('select.countryOptions').on('change',function(e){if($(this).find('option:selected').val()!=$.cookie("LuckyVitaminCountry"))
{var selectedLocaleISOCode=$(this).val();window.location="setlocale.aspx?ReturnURL="+ window.location.pathname+"&ISOCode="+ selectedLocaleISOCode;}});$('.shipping-method-details-link').on('click',function(e){event.stopPropagation();$(this).siblings('.shipping-method-details-popup').toggleClass('active');});$(document).click(function(){if($('.shipping-method-details-popup').hasClass('active')){$('.shipping-method-details-popup').removeClass('active');}});}
function replaceHtml(el,html){var oldEl=typeof el==="string"?document.getElementById(el):el;/*@cc_on // Pure innerHTML is slightly faster in IE
		oldEl.innerHTML = html;
		return oldEl;
	@*/
var newEl=oldEl.cloneNode(false);newEl.innerHTML=html;oldEl.parentNode.replaceChild(newEl,oldEl);return newEl;};function getParameterByName(name){name=name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var regex=new RegExp("[\\?&]"+ name+"=([^&#]*)"),results=regex.exec(location.search);return results==null?"":decodeURIComponent(results[1].replace(/\+/g," "));}
function readCookie(name){var nameEQ=name+"=";var ca=document.cookie.split(';');for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==' ')c=c.substring(1,c.length);if(c.indexOf(nameEQ)==0)return c.substring(nameEQ.length,c.length);}
return null;}
var cookieRegistry=[];function listenCookieChange(cookieName,callback){setInterval(function(){if(cookieRegistry[cookieName]){if(readCookie(cookieName)!=cookieRegistry[cookieName]){cookieRegistry[cookieName]=readCookie(cookieName);return callback();}}else{cookieRegistry[cookieName]=readCookie(cookieName);}},100);}
window.onbeforeprint=function(){$("img.lazy").each(function(){var $this=$(this);if($this.attr('data-original')!==undefined){$this.attr('src',$this.attr('data-original'));}});}
window.onafterprint=function(){$("img.lazy").each(function(){var $this=$(this);if($this.attr('data-original')!==undefined){$this.attr('src',rewritePathForCDN('images/spinner.gif'));}});}
try{var mediaQueryList=window.matchMedia('print');mediaQueryList.addListener(function(mql){if(mql.matches){$("img.lazy").each(function(){var $this=$(this);if($this.attr('data-original')!==undefined){$this.attr('src',$this.attr('data-original'));}});}
else{$("img.lazy").each(function(){var $this=$(this);if($this.attr('data-original')!==undefined){$this.attr('src',rewritePathForCDN('images/spinner.gif'));}});}});}
catch(err){}
function fixListingCadDisplay(){if($('body').data('country')=='en-CA'){$('.products-listview .results-list .text-column .new-price').each(function(){$(this).html($(this).html().replace('(CAD)','<sup>(CAD)</sup>'));});}}
function runSingleValidation(validator){var $validator=$('#'+ validator);if(validator=='ctl00_PageContent_ctrlPaymentMethods_valCardNumber'){var cc=$('#ctl00_PageContent_ctrlPaymentMethods_liCreditCard');if(cc.hasClass('active')){ValidatorEnable($validator[0],true);}else{ValidatorEnable($validator[0],false);}}
else
{ValidatorEnable($validator[0],true);}
ValidatorValidate($validator[0]);if(!$validator[0].isvalid){ValidatorEnable($validator[0],true);$validator.closest(".form-row").removeClass("success");$validator.closest(".form-row").addClass("error");return 0;}
else{ValidatorEnable($('#'+ validator)[0],false);$validator.closest(".form-row").removeClass("error");if(!$validator.hasClass('zip')||!zipCodeResult.waiting)$validator.closest(".form-row").addClass("success");return 1;}}
function getGoInterPayFingerPrint(){$.ajax({url:gipUrl+'finger?MerchantId='+ gipMerchantID,dataType:'script',success:function(){var postData=JSON.stringify({fingerprint:gip_device_fingerprint});$.ajax({type:"POST",url:"ActionService.asmx/SetGoInterPayFingerprint",data:postData,contentType:"application/json; charset=utf-8",dataType:"json"});},async:false});}
