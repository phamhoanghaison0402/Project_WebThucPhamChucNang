(function(){function x(c){if("string"!=typeof c)throw Error("Invalid request opion. attribute must be a non-zero length string.");c=c.trim();if(!c)throw Error("Invalid request opion. attribute must be a non-zero length string.");if(!c.match(z))throw Error("Invalid request option. invalid attribute name: "+c);return c}function A(c){var a={};c.forEach(function(b){b.qualifiers.forEach(function(b){a[b.attrName]=!0})});return Object.keys(a)}if("undefined"==typeof MutationObserver&&"undefined"==typeof WebKitMutationObserver)return!1;
var B=this.__extends||function(c,a){function b(){this.constructor=c}for(var e in a)a.hasOwnProperty(e)&&(c[e]=a[e]);b.prototype=a.prototype;c.prototype=new b},t;t="undefined"!==typeof WebKitMutationObserver?WebKitMutationObserver:MutationObserver;if(void 0===t)throw console.error("DOM Mutation Observers are required."),console.error("https://developer.mozilla.org/en-US/docs/DOM/MutationObserver"),Error("DOM Mutation Observers are required");var n=function(){function c(){this.nodes=[];this.values=
[]}c.prototype.isIndex=function(a){return+a===a>>>0};c.prototype.nodeId=function(a){var b=a[c.ID_PROP];b||(b=a[c.ID_PROP]=c.nextId_++);return b};c.prototype.set=function(a,b){var e=this.nodeId(a);this.nodes[e]=a;this.values[e]=b};c.prototype.get=function(a){a=this.nodeId(a);return this.values[a]};c.prototype.has=function(a){return this.nodeId(a)in this.nodes};c.prototype["delete"]=function(a){a=this.nodeId(a);delete this.nodes[a];this.values[a]=void 0};c.prototype.keys=function(){var a=[],b;for(b in this.nodes)this.isIndex(b)&&
a.push(this.nodes[b]);return a};c.ID_PROP="__mutation_summary_node_map_id__";c.nextId_=1;return c}(),g;(function(c){c[c.STAYED_OUT=0]="STAYED_OUT";c[c.ENTERED=1]="ENTERED";c[c.STAYED_IN=2]="STAYED_IN";c[c.REPARENTED=3]="REPARENTED";c[c.REORDERED=4]="REORDERED";c[c.EXITED=5]="EXITED"})(g||(g={}));var C=function(){function c(a,b,e,d,f,c,k,q){void 0===b&&(b=!1);void 0===e&&(e=!1);void 0===d&&(d=!1);void 0===f&&(f=null);void 0===c&&(c=!1);void 0===k&&(k=null);void 0===q&&(q=null);this.node=a;this.childList=
b;this.attributes=e;this.characterData=d;this.oldParentNode=f;this.added=c;this.attributeOldValues=k;this.characterDataOldValue=q;this.isCaseInsensitive=1===this.node.nodeType&&this.node instanceof HTMLElement&&this.node.ownerDocument instanceof HTMLDocument}c.prototype.getAttributeOldValue=function(a){if(this.attributeOldValues)return this.isCaseInsensitive&&(a=a.toLowerCase()),this.attributeOldValues[a]};c.prototype.getAttributeNamesMutated=function(){var a=[];if(!this.attributeOldValues)return a;
for(var b in this.attributeOldValues)a.push(b);return a};c.prototype.attributeMutated=function(a,b){this.attributes=!0;this.attributeOldValues=this.attributeOldValues||{};a in this.attributeOldValues||(this.attributeOldValues[a]=b)};c.prototype.characterDataMutated=function(a){this.characterData||(this.characterData=!0,this.characterDataOldValue=a)};c.prototype.removedFromParent=function(a){this.childList=!0;this.added||this.oldParentNode?this.added=!1:this.oldParentNode=a};c.prototype.insertedIntoParent=
function(){this.added=this.childList=!0};c.prototype.getOldParent=function(){if(this.childList){if(this.oldParentNode)return this.oldParentNode;if(this.added)return null}return this.node.parentNode};return c}(),y=function(){return function(){this.added=new n;this.removed=new n;this.maybeMoved=new n;this.oldPrevious=new n;this.moved=void 0}}(),D=function(c){function a(b,a){c.call(this);this.rootNode=b;this.wasReachableCache=this.reachableCache=void 0;this.anyCharacterDataChanged=this.anyAttributesChanged=
this.anyParentsChanged=!1;for(var d=0;d<a.length;d++){var f=a[d];switch(f.type){case "childList":this.anyParentsChanged=!0;for(var h=0;h<f.removedNodes.length;h++){var k=f.removedNodes[h];this.getChange(k).removedFromParent(f.target)}for(h=0;h<f.addedNodes.length;h++)k=f.addedNodes[h],this.getChange(k).insertedIntoParent();break;case "attributes":this.anyAttributesChanged=!0;h=this.getChange(f.target);h.attributeMutated(f.attributeName,f.oldValue);break;case "characterData":this.anyCharacterDataChanged=
!0,h=this.getChange(f.target),h.characterDataMutated(f.oldValue)}}}B(a,c);a.prototype.getChange=function(b){var a=this.get(b);a||(a=new C(b),this.set(b,a));return a};a.prototype.getOldParent=function(b){var a=this.get(b);return a?a.getOldParent():b.parentNode};a.prototype.getIsReachable=function(b){if(b===this.rootNode)return!0;if(!b)return!1;this.reachableCache=this.reachableCache||new n;var a=this.reachableCache.get(b);void 0===a&&(a=this.getIsReachable(b.parentNode),this.reachableCache.set(b,a));
return a};a.prototype.getWasReachable=function(b){if(b===this.rootNode)return!0;if(!b)return!1;this.wasReachableCache=this.wasReachableCache||new n;var a=this.wasReachableCache.get(b);void 0===a&&(a=this.getWasReachable(this.getOldParent(b)),this.wasReachableCache.set(b,a));return a};a.prototype.reachabilityChange=function(b){return this.getIsReachable(b)?this.getWasReachable(b)?g.STAYED_IN:g.ENTERED:this.getWasReachable(b)?g.EXITED:g.STAYED_OUT};return a}(n),E=function(){function c(a,b,e,d,f){this.rootNode=
a;this.mutations=b;this.selectors=e;this.calcReordered=d;this.calcOldPreviousSibling=f;this.treeChanges=new D(a,b);this.entered=[];this.exited=[];this.stayedIn=new n;this.visited=new n;this.matchCache=this.characterDataOnly=this.childListChangeMap=void 0;this.processMutations()}c.prototype.processMutations=function(){if(this.treeChanges.anyParentsChanged||this.treeChanges.anyAttributesChanged)for(var a=this.treeChanges.keys(),b=0;b<a.length;b++)this.visitNode(a[b],void 0)};c.prototype.visitNode=function(a,
b){if(!this.visited.has(a)){this.visited.set(a,!0);var e=this.treeChanges.get(a),d=b;if(e&&e.childList||void 0==d)d=this.treeChanges.reachabilityChange(a);if(d!==g.STAYED_OUT){this.matchabilityChange(a);if(d===g.ENTERED)this.entered.push(a);else if(d===g.EXITED)this.exited.push(a),this.ensureHasOldPreviousSiblingIfNeeded(a);else if(d===g.STAYED_IN){var f=g.STAYED_IN;e&&e.childList&&(e.oldParentNode!==a.parentNode?(f=g.REPARENTED,this.ensureHasOldPreviousSiblingIfNeeded(a)):this.calcReordered&&this.wasReordered(a)&&
(f=g.REORDERED));this.stayedIn.set(a,f)}if(d!==g.STAYED_IN)for(e=a.firstChild;e;e=e.nextSibling)this.visitNode(e,d)}}};c.prototype.ensureHasOldPreviousSiblingIfNeeded=function(a){if(this.calcOldPreviousSibling){this.processChildlistChanges();var b=a.parentNode,e=this.treeChanges.get(a);e&&e.oldParentNode&&(b=e.oldParentNode);e=this.childListChangeMap.get(b);e||(e=new y,this.childListChangeMap.set(b,e));e.oldPrevious.has(a)||e.oldPrevious.set(a,a.previousSibling)}};c.prototype.getChanged=function(a,
b,e){this.selectors=b;this.characterDataOnly=e;for(b=0;b<this.entered.length;b++){e=this.entered[b];var d=this.matchabilityChange(e);d!==g.ENTERED&&d!==g.STAYED_IN||a.added.push(e)}var f=this.stayedIn.keys();for(b=0;b<f.length;b++)e=f[b],d=this.matchabilityChange(e),d===g.ENTERED?a.added.push(e):d===g.EXITED?a.removed.push(e):d===g.STAYED_IN&&(a.reparented||a.reordered)&&(d=this.stayedIn.get(e),a.reparented&&d===g.REPARENTED?a.reparented.push(e):a.reordered&&d===g.REORDERED&&a.reordered.push(e));
for(b=0;b<this.exited.length;b++)e=this.exited[b],d=this.matchabilityChange(e),d!==g.EXITED&&d!==g.STAYED_IN||a.removed.push(e)};c.prototype.getOldParentNode=function(a){var b=this.treeChanges.get(a);if(b&&b.childList)return b.oldParentNode?b.oldParentNode:null;b=this.treeChanges.reachabilityChange(a);if(b===g.STAYED_OUT||b===g.ENTERED)throw Error("getOldParentNode requested on invalid node.");return a.parentNode};c.prototype.getOldPreviousSibling=function(a){var b=a.parentNode,e=this.treeChanges.get(a);
e&&e.oldParentNode&&(b=e.oldParentNode);b=this.childListChangeMap.get(b);if(!b)throw Error("getOldPreviousSibling requested on invalid node.");return b.oldPrevious.get(a)};c.prototype.getOldAttribute=function(a,b){var e=this.treeChanges.get(a);if(!e||!e.attributes)throw Error("getOldAttribute requested on invalid node.");e=e.getAttributeOldValue(b);if(void 0===e)throw Error("getOldAttribute requested for unchanged attribute name.");return e};c.prototype.attributeChangedNodes=function(a){if(!this.treeChanges.anyAttributesChanged)return{};
var b,e;if(a){b={};e={};for(var d=0;d<a.length;d++){var f=a[d];b[f]=!0;e[f.toLowerCase()]=f}}a={};for(var c=this.treeChanges.keys(),d=0;d<c.length;d++){var f=c[d],k=this.treeChanges.get(f);if(k.attributes&&g.STAYED_IN===this.treeChanges.reachabilityChange(f)&&g.STAYED_IN===this.matchabilityChange(f))for(var q=f,m=k.getAttributeNamesMutated(),p=0;p<m.length;p++)f=m[p],(!b||b[f]||k.isCaseInsensitive&&e[f])&&k.getAttributeOldValue(f)!==q.getAttribute(f)&&(e&&k.isCaseInsensitive&&(f=e[f]),a[f]=a[f]||
[],a[f].push(q))}return a};c.prototype.getOldCharacterData=function(a){a=this.treeChanges.get(a);if(!a||!a.characterData)throw Error("getOldCharacterData requested on invalid node.");return a.characterDataOldValue};c.prototype.getCharacterDataChanged=function(){if(!this.treeChanges.anyCharacterDataChanged)return[];for(var a=this.treeChanges.keys(),b=[],e=0;e<a.length;e++){var d=a[e];if(g.STAYED_IN===this.treeChanges.reachabilityChange(d)){var f=this.treeChanges.get(d);f.characterData&&d.textContent!=
f.characterDataOldValue&&b.push(d)}}return b};c.prototype.computeMatchabilityChange=function(a,b){this.matchCache||(this.matchCache=[]);this.matchCache[a.uid]||(this.matchCache[a.uid]=new n);var e=this.matchCache[a.uid],d=e.get(b);void 0===d&&(d=a.matchabilityChange(b,this.treeChanges.get(b)),e.set(b,d));return d};c.prototype.matchabilityChange=function(a){var b=this;if(this.characterDataOnly)switch(a.nodeType){case 8:case 3:return g.STAYED_IN;default:return g.STAYED_OUT}if(!this.selectors)return g.STAYED_IN;
if(1!==a.nodeType)return g.STAYED_OUT;for(var e=this.selectors.map(function(e){return b.computeMatchabilityChange(e,a)}),d=g.STAYED_OUT,f=0;d!==g.STAYED_IN&&f<e.length;){switch(e[f]){case g.STAYED_IN:d=g.STAYED_IN;break;case g.ENTERED:d=d===g.EXITED?g.STAYED_IN:g.ENTERED;break;case g.EXITED:d=d===g.ENTERED?g.STAYED_IN:g.EXITED}f++}return d};c.prototype.getChildlistChange=function(a){var b=this.childListChangeMap.get(a);b||(b=new y,this.childListChangeMap.set(a,b));return b};c.prototype.processChildlistChanges=
function(){if(!this.childListChangeMap){this.childListChangeMap=new n;for(var a=0;a<this.mutations.length;a++){var b=function(b,a){!b||d.oldPrevious.has(b)||d.added.has(b)||d.maybeMoved.has(b)||a&&(d.added.has(a)||d.maybeMoved.has(a))||d.oldPrevious.set(b,a)},e=this.mutations[a];if("childList"==e.type&&(this.treeChanges.reachabilityChange(e.target)===g.STAYED_IN||this.calcOldPreviousSibling)){for(var d=this.getChildlistChange(e.target),f=e.previousSibling,c=0;c<e.removedNodes.length;c++){var k=e.removedNodes[c];
b(k,f);if(d.added.has(k))d.added["delete"](k);else d.removed.set(k,!0),d.maybeMoved["delete"](k);f=k}b(e.nextSibling,f);for(c=0;c<e.addedNodes.length;c++)k=e.addedNodes[c],d.removed.has(k)?(d.removed["delete"](k),d.maybeMoved.set(k,!0)):d.added.set(k,!0)}}}};c.prototype.wasReordered=function(a){function b(a){if(!a||!c.maybeMoved.has(a))return!1;var d=c.moved.get(a);if(void 0!==d)return d;if(k.has(a))d=!0;else{k.set(a,!0);if(m.has(a))d=m.get(a);else{for(d=a.previousSibling;d&&(c.added.has(d)||b(d));)d=
d.previousSibling;m.set(a,d)}d=d!==e(a)}k.has(a)?(k["delete"](a),c.moved.set(a,d)):d=c.moved.get(a);return d}function e(a){var d=g.get(a);if(void 0!==d)return d;for(d=c.oldPrevious.get(a);d&&(c.removed.has(d)||b(d));)d=e(d);void 0===d&&(d=a.previousSibling);g.set(a,d);return d}if(!this.treeChanges.anyParentsChanged)return!1;this.processChildlistChanges();var d=a.parentNode,f=this.treeChanges.get(a);f&&f.oldParentNode&&(d=f.oldParentNode);var c=this.childListChangeMap.get(d);if(!c)return!1;if(c.moved)return c.moved.get(a);
c.moved=new n;var k=new n,g=new n,m=new n;c.maybeMoved.keys().forEach(b);return c.moved.get(a)};return c}(),F=function(){function c(a,b){var e=this;this.projection=a;this.added=[];this.removed=[];this.reparented=b.all||b.element||b.characterData?[]:void 0;this.reordered=b.all?[]:void 0;a.getChanged(this,b.elementFilter,b.characterData);if(b.all||b.attribute||b.attributeList){var d=a.attributeChangedNodes(b.attribute?[b.attribute]:b.attributeList);b.attribute?this.valueChanged=d[b.attribute]||[]:(this.attributeChanged=
d,b.attributeList&&b.attributeList.forEach(function(b){e.attributeChanged.hasOwnProperty(b)||(e.attributeChanged[b]=[])}))}if(b.all||b.characterData)d=a.getCharacterDataChanged(),b.characterData?this.valueChanged=d:this.characterDataChanged=d;this.reordered&&(this.getOldPreviousSibling=a.getOldPreviousSibling.bind(a))}c.prototype.getOldParentNode=function(a){return this.projection.getOldParentNode(a)};c.prototype.getOldAttribute=function(a,b){return this.projection.getOldAttribute(a,b)};c.prototype.getOldCharacterData=
function(a){return this.projection.getOldCharacterData(a)};c.prototype.getOldPreviousSibling=function(a){return this.projection.getOldPreviousSibling(a)};return c}(),u=/[a-zA-Z_]+/,v=/[a-zA-Z0-9_\-]+/,G=function(){function c(){}c.prototype.matches=function(a){if(null===a)return!1;if(void 0===this.attrValue)return!0;if(!this.contains)return this.attrValue==a;a=a.split(" ");for(var b=0;b<a.length;b++)if(this.attrValue===a[b])return!0;return!1};c.prototype.toString=function(){return"class"===this.attrName&&
this.contains?"."+this.attrValue:"id"!==this.attrName||this.contains?this.contains?"["+this.attrName+"~="+('"'+this.attrValue.replace(/"/,'\\"')+'"')+"]":"attrValue"in this?"["+this.attrName+"="+('"'+this.attrValue.replace(/"/,'\\"')+'"')+"]":"["+this.attrName+"]":"#"+this.attrValue};return c}(),w=function(){function c(){this.uid=c.nextUid++;this.qualifiers=[]}Object.defineProperty(c.prototype,"caseInsensitiveTagName",{get:function(){return this.tagName.toUpperCase()},enumerable:!0,configurable:!0});
Object.defineProperty(c.prototype,"selectorString",{get:function(){return this.tagName+this.qualifiers.join("")},enumerable:!0,configurable:!0});c.prototype.isMatching=function(a){return a[c.matchesSelector](this.selectorString)};c.prototype.wasMatching=function(a,b,e){if(!b||!b.attributes)return e;var d=b.isCaseInsensitive?this.caseInsensitiveTagName:this.tagName;if("*"!==d&&d!==a.tagName)return!1;for(var d=[],c=!1,h=0;h<this.qualifiers.length;h++){var k=this.qualifiers[h],g=b.getAttributeOldValue(k.attrName);
d.push(g);c=c||void 0!==g}if(!c)return e;for(h=0;h<this.qualifiers.length;h++)if(k=this.qualifiers[h],g=d[h],void 0===g&&(g=a.getAttribute(k.attrName)),!k.matches(g))return!1;return!0};c.prototype.matchabilityChange=function(a,b){var e=this.isMatching(a);return e?this.wasMatching(a,b,e)?g.STAYED_IN:g.ENTERED:this.wasMatching(a,b,e)?g.EXITED:g.STAYED_OUT};c.parseSelectors=function(a){function b(){f&&(h&&(f.qualifiers.push(h),h=void 0),d.push(f));f=new c}function e(){h&&f.qualifiers.push(h);h=new G}
for(var d=[],f,h,k=/\s/,g,m=1,p=0;p<a.length;){var l=a[p++];switch(m){case 1:if(l.match(u)){b();f.tagName=l;m=2;break}if("*"==l){b();f.tagName="*";m=3;break}if("."==l){b();e();f.tagName="*";h.attrName="class";h.contains=!0;m=4;break}if("#"==l){b();e();f.tagName="*";h.attrName="id";m=4;break}if("["==l){b();e();f.tagName="*";h.attrName="";m=6;break}if(l.match(k))break;throw Error("Invalid or unsupported selector syntax.");case 2:if(l.match(v)){f.tagName+=l;break}if("."==l){e();h.attrName="class";h.contains=
!0;m=4;break}if("#"==l){e();h.attrName="id";m=4;break}if("["==l){e();h.attrName="";m=6;break}if(l.match(k)){m=14;break}if(","==l){m=1;break}throw Error("Invalid or unsupported selector syntax.");case 3:if("."==l){e();h.attrName="class";h.contains=!0;m=4;break}if("#"==l){e();h.attrName="id";m=4;break}if("["==l){e();h.attrName="";m=6;break}if(l.match(k)){m=14;break}if(","==l){m=1;break}throw Error("Invalid or unsupported selector syntax.");case 4:if(l.match(u)){h.attrValue=l;m=5;break}throw Error("Invalid or unsupported selector syntax.");
case 5:if(l.match(v)){h.attrValue+=l;break}if("."==l){e();h.attrName="class";h.contains=!0;m=4;break}if("#"==l){e();h.attrName="id";m=4;break}if("["==l){e();m=6;break}if(l.match(k)){m=14;break}if(","==l){m=1;break}throw Error("Invalid or unsupported selector syntax.");case 6:if(l.match(u)){h.attrName=l;m=7;break}if(l.match(k))break;throw Error("Invalid or unsupported selector syntax.");case 7:if(l.match(v)){h.attrName+=l;break}if(l.match(k)){m=8;break}if("~"==l){h.contains=!0;m=9;break}if("="==l){h.attrValue=
"";m=11;break}if("]"==l){m=3;break}throw Error("Invalid or unsupported selector syntax.");case 8:if("~"==l){h.contains=!0;m=9;break}if("="==l){h.attrValue="";m=11;break}if("]"==l){m=3;break}if(l.match(k))break;throw Error("Invalid or unsupported selector syntax.");case 9:if("="==l){h.attrValue="";m=11;break}throw Error("Invalid or unsupported selector syntax.");case 10:if("]"==l){m=3;break}if(l.match(k))break;throw Error("Invalid or unsupported selector syntax.");case 11:if(l.match(k))break;if('"'==
l||"'"==l){g=l;m=13;break}h.attrValue+=l;m=12;break;case 12:if(l.match(k)){m=10;break}if("]"==l){m=3;break}if("'"==l||'"'==l)throw Error("Invalid or unsupported selector syntax.");h.attrValue+=l;break;case 13:if(l==g){m=10;break}h.attrValue+=l;break;case 14:if(!l.match(k))if(","==l)m=1;else throw Error("Invalid or unsupported selector syntax.");}}switch(m){case 1:case 2:case 3:case 5:case 14:b();break;default:throw Error("Invalid or unsupported selector syntax.");}if(!d.length)throw Error("Invalid or unsupported selector syntax.");
return d};c.nextUid=1;c.matchesSelector=function(){var a=document.createElement("div");return"function"===typeof a.webkitMatchesSelector?"webkitMatchesSelector":"function"===typeof a.mozMatchesSelector?"mozMatchesSelector":"function"===typeof a.msMatchesSelector?"msMatchesSelector":"matchesSelector"}();return c}(),z=/^([a-zA-Z:_]+[a-zA-Z0-9_\-:\.]*)$/,r=function(){function c(a){var b=this;this.connected=!1;this.options=c.validateOptions(a);this.observerOptions=c.createObserverOptions(this.options.queries);
this.root=this.options.rootNode;this.callback=this.options.callback;this.elementFilter=Array.prototype.concat.apply([],this.options.queries.map(function(b){return b.elementFilter?b.elementFilter:[]}));this.elementFilter.length||(this.elementFilter=void 0);this.calcReordered=this.options.queries.some(function(b){return b.all});this.queryValidators=[];c.createQueryValidator&&(this.queryValidators=this.options.queries.map(function(a){return c.createQueryValidator(b.root,a)}));this.observer=new t(function(a){b.observerCallback(a)});
this.reconnect()}c.createObserverOptions=function(a){function b(b){if(!e.attributes||d)e.attributes=!0,e.attributeOldValue=!0,b?(d=d||{},b.forEach(function(b){d[b]=!0;d[b.toLowerCase()]=!0})):d=void 0}var e={childList:!0,subtree:!0},d;a.forEach(function(a){a.characterData?(e.characterData=!0,e.characterDataOldValue=!0):a.all?(b(),e.characterData=!0,e.characterDataOldValue=!0):a.attribute?b([a.attribute.trim()]):(a=A(a.elementFilter).concat(a.attributeList||[]),a.length&&b(a))});d&&(e.attributeFilter=
Object.keys(d));return e};c.validateOptions=function(a){for(var b in a)if(!(b in c.optionKeys))throw Error("Invalid option: "+b);if("function"!==typeof a.callback)throw Error("Invalid options: callback is required and must be a function");if(!a.queries||!a.queries.length)throw Error("Invalid options: queries must contain at least one query request object.");b={callback:a.callback,rootNode:a.rootNode||document,observeOwnChanges:!!a.observeOwnChanges,oldPreviousSibling:!!a.oldPreviousSibling,queries:[]};
for(var e=0;e<a.queries.length;e++){var d=a.queries[e];if(d.all){if(1<Object.keys(d).length)throw Error("Invalid request option. all has no options.");b.queries.push({all:!0})}else if("attribute"in d){var f={attribute:x(d.attribute)};f.elementFilter=w.parseSelectors("*["+f.attribute+"]");if(1<Object.keys(d).length)throw Error("Invalid request option. attribute has no options.");b.queries.push(f)}else if("element"in d){var h=Object.keys(d).length,f={element:d.element,elementFilter:w.parseSelectors(d.element)};
if(d.hasOwnProperty("elementAttributes")){var k=f,g=d.elementAttributes;if(!g.trim().length)throw Error("Invalid request option: elementAttributes must contain at least one attribute.");for(var d={},m={},g=g.split(/\s+/),p=0;p<g.length;p++){var l=g[p];if(l){var l=x(l),n=l.toLowerCase();if(d[n])throw Error("Invalid request option: observing multiple case variations of the same attribute is not supported.");m[l]=!0;d[n]=!0}}d=Object.keys(m);k.attributeList=d;h--}if(1<h)throw Error("Invalid request option. element only allows elementAttributes option.");
b.queries.push(f)}else if(d.characterData){if(1<Object.keys(d).length)throw Error("Invalid request option. characterData has no options.");b.queries.push({characterData:!0})}else throw Error("Invalid request option. Unknown query request.");}return b};c.prototype.createSummaries=function(a){if(!a||!a.length)return[];a=new E(this.root,a,this.elementFilter,this.calcReordered,this.options.oldPreviousSibling);for(var b=[],e=0;e<this.options.queries.length;e++)b.push(new F(a,this.options.queries[e]));
return b};c.prototype.checkpointQueryValidators=function(){this.queryValidators.forEach(function(a){a&&a.recordPreviousState()})};c.prototype.runQueryValidators=function(a){this.queryValidators.forEach(function(b,e){b&&b.validate(a[e])})};c.prototype.changesToReport=function(a){return a.some(function(b){return"added removed reordered reparented valueChanged characterDataChanged".split(" ").some(function(a){return b[a]&&b[a].length})||b.attributeChanged&&Object.keys(b.attributeChanged).some(function(a){return!!b.attributeChanged[a].length})?
!0:!1})};c.prototype.observerCallback=function(a){this.options.observeOwnChanges||this.observer.disconnect();a=this.createSummaries(a);this.runQueryValidators(a);this.options.observeOwnChanges&&this.checkpointQueryValidators();this.changesToReport(a)&&this.callback(a);!this.options.observeOwnChanges&&this.connected&&(this.checkpointQueryValidators(),this.observer.observe(this.root,this.observerOptions))};c.prototype.reconnect=function(){if(this.connected)throw Error("Already connected");this.observer.observe(this.root,
this.observerOptions);this.connected=!0;this.checkpointQueryValidators()};c.prototype.takeSummaries=function(){if(!this.connected)throw Error("Not connected");var a=this.createSummaries(this.observer.takeRecords());return this.changesToReport(a)?a:void 0};c.prototype.disconnect=function(){var a=this.takeSummaries();this.observer.disconnect();this.connected=!1;return a};c.NodeMap=n;c.parseElementFilter=w.parseSelectors;c.optionKeys={callback:!0,queries:!0,rootNode:!0,oldPreviousSibling:!0,observeOwnChanges:!0};
return c}(),H=function(){function c(b,a,d){var c=this;this.target=b;this.mirror=a;this.nextId=1;this.knownNodes=new r.NodeMap;a=[{all:!0}];d&&(a=a.concat(d));this.mutationSummary=new r({rootNode:b,callback:function(b){c.applyChanged(b)},queries:a});d=this.serializeNode(b).i;a=[];for(b=b.firstChild;b;b=b.nextSibling)a.push(this.serializeNode(b,!0));this.mirror.initialize(d,a)}function a(b){try{var a="";"string"==(typeof b.className).toLowerCase()&&(a=b.className.toLowerCase());return-1<a.indexOf("losensitive")?
!0:!1}catch(d){return!0}}c.prototype.disconnect=function(){this.mutationSummary&&(this.mutationSummary.disconnect(),this.mutationSummary=void 0)};c.prototype.rememberNode=function(a){var e=this.nextId++;this.knownNodes.set(a,e);return e};c.prototype.forgetNode=function(a){this.knownNodes["delete"](a)};c.prototype.serializeNode=function(b,e,d){d=d||0;d++;if(1E4<d)return console&&console.log&&console.log("Too much recursion"),null;if(null===b)return null;var c=this.knownNodes.get(b);if(void 0!==c)return{i:c};
if(b.tagName&&"SCRIPT"==b.tagName.toUpperCase())return null;c={n:b.nodeType,i:this.rememberNode(b)};switch(c.n){case 10:c.name=b.name;c.publicId=b.publicId;c.systemId=b.systemId;break;case 8:case 3:if(b.parentElement&&b.parentElement.getAttribute("type")&&"string"==typeof b.parentElement.getAttribute("type")&&"textarea"==b.parentElement.getAttribute("type").toLowerCase()){d="";for(e=0;e<b.textContent.length;e++)d+="*";c.t=d}else if("string"==(typeof b.className).toLowerCase()&&b.className.toLowerCase(),
b.parentElement&&"string"==(typeof b.parentElement.className).toLowerCase()&&b.parentElement.className.toLowerCase(),c.t=b.textContent,d=!1,b.parentElement&&"STYLE"==b.parentElement.tagName&&(d=!0),window.LO&&window.LO.scramble&&1==window.LO.scramble()&&0==d&&(c.t=window.LO.scramble(b.textContent)),window.LO&&window.LO.is_sensitive&&1==window.LO.is_sensitive(b)){d="";for(e=0;e<b.textContent.length;e++)d+="*";c.t=d}break;case 1:c.g=b.tagName;c.a={};try{var h;b instanceof SVGElement&&((h=a(b))?(c.g=
"IMG",c.s.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"):c.v=1);b instanceof HTMLCanvasElement&&(h=a(b),c.g="IMG",h||window.top.__lo_ignore_canvas?c.s.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7":c.a.src=b.toDataURL())}catch(m){}h=!1;var k="";b&&b.nodeName&&(k=b.nodeName.toLowerCase());if("script"==k)return c;if("input"==k||"textarea"==k)if(h=!0,"input"==k&&b.type&&(k=b.type.toLowerCase(),"submit"==k||"button"==k))h=!1;
for(k=0;k<b.attributes.length;k++){var g=b.attributes[k];h&&g.name&&"value"==g.name.toLowerCase()?c.a[g.name]="":c.a[g.name]=g.value}if(e&&b.childNodes.length)for(c.c=[],b=b.firstChild;b;b=b.nextSibling)c.c.push(this.serializeNode(b,!0,d))}return c=this.shrinkKeys(c)};c.prototype.shrinkKeys=function(a){var c={},d={attributes:"a",id:"i",nodeType:"n",textContent:"t",tagName:"g",childNodes:"c"},f;for(f in a)d[f]?c[d[f]]=a[f]:c[f]=a[f];return c};c.prototype.expandKeys=function(a){var c={},d={a:"attributes",
i:"id",n:"nodeType",t:"textContent",g:"tagName",c:"childNodes"},f;for(f in a)d[f]?c[d[f]]=a[f]:c[f]=a[f];return c};c.prototype.serializeAddedAndMoved=function(a,c,d){var f=this;a=a.concat(c).concat(d);var h=new r.NodeMap;a.forEach(function(a){var b=a.parentNode,c=h.get(b);c||(c=new r.NodeMap,h.set(b,c));c.set(a,!0)});var g=[];h.keys().forEach(function(a){a=h.get(a);for(var b=a.keys();b.length;){for(b=b[0];b.previousSibling&&a.has(b.previousSibling);)b=b.previousSibling;for(;b&&a.has(b);){var c=f.serializeNode(b);
c&&(c.previousSibling=f.serializeNode(b.previousSibling),c.parentNode=f.serializeNode(b.parentNode),g.push(c));a["delete"](b);b=b.nextSibling}b=a.keys()}});return g};c.prototype.serializeAttributeChanges=function(a){var c=this,d=new r.NodeMap;Object.keys(a).forEach(function(f){a[f].forEach(function(a){var b=d.get(a);!b&&(b=c.serializeNode(a))&&(b.attributes={},d.set(a,b));b&&(b.attributes[f]=a.getAttribute(f))})});return d.keys().map(function(a){return d.get(a)})};c.prototype.applyChanged=function(a){var c=
this;a=a[0];var d=a.removed.map(function(a){return c.serializeNode(a)}),f=this.serializeAddedAndMoved(a.added,a.reparented,a.reordered),g=this.serializeAttributeChanges(a.attributeChanged),k=a.characterDataChanged.map(function(a){var b=c.serializeNode(a);b.textContent=a.textContent;return b});this.mirror.applyChanged(d,f,g,k);a.removed.forEach(function(a){c.forgetNode(a)})};return c}();window.TreeMirrorClient=H;window.MutationSummary=r})();